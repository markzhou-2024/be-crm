{"version":3,"file":"index.js","sources":["pages/calendar/index.vue","pages/calendar/index.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view class=\"top-bar\">\n      <picker class=\"store-picker\" mode=\"selector\" :range=\"storeOptions\" range-key=\"label\" :value=\"storeIndex\" @change=\"onStoreChange\">\n        <view class=\"picker-trigger\">\n          {{ currentStoreLabel }}\n        </view>\n      </picker>\n      <view class=\"month-switch\">\n        <button class=\"nav-btn\" @tap=\"changeMonth(-1)\">‹</button>\n        <text class=\"month-label\">{{ displayMonth }}</text>\n        <button class=\"nav-btn\" @tap=\"changeMonth(1)\">›</button>\n      </view>\n    </view>\n\n    <view class=\"calendar\">\n      <view class=\"week-header\">\n        <text v-for=\"day in weekLabels\" :key=\"day\">{{ day }}</text>\n      </view>\n      <view class=\"day-grid\">\n        <view\n          v-for=\"day in calendarDays\"\n          :key=\"day.date\"\n          class=\"day-cell\"\n          :class=\"{ dim: !day.inMonth, today: day.isToday }\"\n          @tap=\"openDayDetail(day)\"\n        >\n          <text class=\"day-text\">{{ day.day }}</text>\n          <view class=\"badge booking\" v-if=\"day.booking_count\">{{ day.booking_count }}</view>\n          <view class=\"badge consume\" v-if=\"day.consume_count\">{{ day.consume_count }}</view>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\n// @ts-nocheck\nimport { fetchMonthCalendarSummary } from '@/api/analytics.js'\nimport { fetchShops } from '@/api/shops.js'\n\nexport default {\n  data() {\n    return {\n      storeOptions: [{ label: '全部门店', value: '' }],\n      storeIndex: 0,\n      currentMonth: this.formatMonth(new Date()),\n      displayMonth: '',\n      calendarDays: [],\n      weekLabels: ['一', '二', '三', '四', '五', '六', '日']\n    }\n  },\n  async onShow() {\n    await this.ensureStores()\n    await this.loadCalendar()\n  },\n  methods: {\n    formatMonth(date) {\n      const d = new Date(date)\n      const y = d.getFullYear()\n      const m = `${d.getMonth() + 1}`.padStart(2, '0')\n      return `${y}-${m}`\n    },\n    async ensureStores() {\n      if (this.storeOptions.length > 1) return\n      try {\n        const list = await fetchShops()\n        const mapped = list.map(item => ({ label: item.name, value: item._id || item.id }))\n        this.storeOptions = [{ label: '全部门店', value: '' }, ...mapped]\n      } catch (err) {\n        console.log('fetch shops failed', err)\n      }\n    },\n    async loadCalendar() {\n      try {\n        const store = this.storeOptions[this.storeIndex]?.value || ''\n        const res = await fetchMonthCalendarSummary({ month: this.currentMonth, store_id: store || undefined })\n        const days = res?.days || []\n        const today = new Date()\n        today.setHours(0, 0, 0, 0)\n        this.displayMonth = res?.month || this.currentMonth\n        const monthKey = this.displayMonth || this.currentMonth\n        const [targetYear, targetMonth] = monthKey.split('-').map(n => Number(n))\n        this.calendarDays = days.map(day => {\n          const dateObj = new Date(day.date.replace(/-/g, '/'))\n          const inMonth = dateObj.getFullYear() === targetYear && (dateObj.getMonth() + 1) === targetMonth\n          return {\n            ...day,\n            day: `${dateObj.getDate()}`,\n            inMonth,\n            isToday: dateObj.getTime() === today.getTime()\n          }\n        })\n      } catch (err) {\n        uni.showToast({ title: err?.message || '加载失败', icon: 'none' })\n      }\n    },\n    changeMonth(step) {\n      const [year, month] = this.currentMonth.split('-').map(n => Number(n))\n      const next = new Date(year, month - 1 + step, 1)\n      this.currentMonth = this.formatMonth(next)\n      this.loadCalendar()\n    },\n    onStoreChange(e) {\n      this.storeIndex = Number(e?.detail?.value || 0)\n      this.loadCalendar()\n    },\n    openDayDetail(day) {\n      uni.showModal({\n        title: day.date,\n        content: `预约：${day.booking_count} 条\\n消耗：${day.consume_count} 次`\n      })\n    }\n  },\n  computed: {\n    currentStoreLabel() {\n      return this.storeOptions[this.storeIndex]?.label || '全部门店'\n    }\n  }\n}\n</script>\n\n<style scoped>\n.page { min-height:100vh; background:#f6f7f9; padding:16px; box-sizing:border-box; }\n.top-bar { display:flex; flex-direction:column; gap:12px; margin-bottom:12px; }\n.store-picker .picker-trigger { background:#fff; border-radius:18px; padding:12px 14px; box-shadow:0 6px 16px rgba(0,0,0,0.05); color:#333; }\n.month-switch { display:flex; align-items:center; justify-content:center; gap:12px; }\n.nav-btn { width:36px; height:36px; border-radius:18px; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,0.08); text-align:center; line-height:36px; font-size:20px; color:#caa265; }\n.month-label { font-size:18px; font-weight:600; color:#1c1c1e; }\n.calendar { background:#fff; border-radius:24px; padding:16px; box-shadow:0 12px 30px rgba(0,0,0,0.05); }\n.week-header { display:grid; grid-template-columns:repeat(7,1fr); text-align:center; font-size:12px; color:#8e8e93; margin-bottom:10px; }\n.day-grid { display:grid; grid-template-columns:repeat(7,1fr); grid-row-gap:14px; grid-column-gap:6px; }\n.day-cell { min-height:58px; border-radius:16px; padding:6px; position:relative; display:flex; flex-direction:column; align-items:flex-start; }\n.day-cell.dim .day-text { color:#c0c0c8; }\n.day-cell.today { border:1px solid #caa265; }\n.day-text { font-size:14px; font-weight:600; color:#1c1c1e; }\n.badge { position:absolute; right:6px; width:20px; height:20px; border-radius:10px; font-size:11px; color:#fff; text-align:center; line-height:20px; }\n.badge.booking { top:6px; background:#caa265; }\n.badge.consume { bottom:6px; background:#20c997; }\n</style>\n","import MiniProgramPage from '/Users/zhouzhongwei/Documents/HBuilderProjects/be-crm-main/pages/calendar/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["fetchShops","uni","fetchMonthCalendarSummary"],"mappings":"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"}