{"version":3,"file":"index.js","sources":["pages/bookings/index.vue","pages/bookings/index.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view class=\"header\">\n      <text class=\"title\">全部预约</text>\n      <view class=\"filters\">\n        <view\n          class=\"filter-pill\"\n          v-for=\"opt in statusOptions\"\n          :key=\"opt.value\"\n          :class=\"{ active: statusFilter === opt.value }\"\n          @tap=\"setStatus(opt.value)\"\n        >\n          {{ opt.label }}\n        </view>\n      </view>\n    </view>\n\n    <scroll-view\n      class=\"content\"\n      scroll-y\n      refresher-enabled\n      :refresher-triggered=\"isRefreshing\"\n      @refresherrefresh=\"handleRefresh\"\n    >\n      <view v-if=\"loading\" class=\"placeholder\">加载中...</view>\n      <view v-else-if=\"!groupedBookings.length\" class=\"placeholder\">暂无预约记录</view>\n      <view v-else class=\"group-list\">\n        <view class=\"group\" v-for=\"group in groupedBookings\" :key=\"group.date\">\n          <view class=\"group-title\">{{ formatGroupDate(group.date) }}</view>\n          <view class=\"booking-card\" v-for=\"item in group.items\" :key=\"item._id || item.id\" @tap=\"goCustomerDetail(item)\">\n            <view class=\"time\">\n              <text class=\"time-main\">{{ formatTime(item.start_ts) }}</text>\n              <text class=\"time-sub\">{{ formatTime(item.end_ts) }}</text>\n            </view>\n            <view class=\"info\">\n              <view class=\"info-title\">{{ item.customer_name || '客户' }} · {{ item.service_name || '项目' }}</view>\n              <view class=\"info-sub\">{{ item.store_name || '未指定门店' }}<text v-if=\"item.staff_name\"> · {{ item.staff_name }}</text></view>\n            </view>\n            <view class=\"status-pill\" :class=\"statusClass(item.status)\">{{ statusLabel(item.status) }}</view>\n          </view>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script>\n// @ts-nocheck\nimport { listTodayBookings } from '@/api/bookings.js'\n\nexport default {\n  data() {\n    return {\n      loading: false,\n      rawBookings: [],\n      statusFilter: 'all',\n      statusOptions: [\n        { label: '全部', value: 'all' },\n        { label: '待到店', value: 'scheduled' },\n        { label: '已完成', value: 'completed' },\n        { label: '已取消', value: 'canceled' }\n      ],\n      isRefreshing: false\n    }\n  },\n  onShow() {\n    this.fetchBookings()\n  },\n  computed: {\n    groupedBookings() {\n      const list = this.filteredBookings()\n      const map = {}\n      list.forEach(item => {\n        const dateKey = this.formatDateKey(item.start_ts)\n        map[dateKey] = map[dateKey] || []\n        map[dateKey].push(item)\n      })\n      return Object.keys(map)\n        .sort((a, b) => (a > b ? -1 : 1))\n        .map(key => ({\n          date: key,\n          items: map[key].sort((a, b) => Number(a.start_ts || 0) - Number(b.start_ts || 0))\n        }))\n    }\n  },\n  methods: {\n    filteredBookings() {\n      if (this.statusFilter === 'all') return this.rawBookings\n      return this.rawBookings.filter(item => item.status === this.statusFilter)\n    },\n    async fetchBookings(options = {}) {\n      const showLoading = !this.rawBookings.length && !options.silent\n      if (showLoading) {\n        this.loading = true\n      }\n      try {\n        const list = await listTodayBookings()\n        this.rawBookings = (list || []).map(item => ({\n          ...item,\n          start_ts: Number(item.start_ts || item.startTs || 0),\n          end_ts: Number(item.end_ts || item.endTs || 0)\n        }))\n      } catch (err) {\n        uni.showToast({ title: err?.errMsg || err?.message || '预约加载失败', icon: 'none' })\n      } finally {\n        if (showLoading) {\n          this.loading = false\n        }\n      }\n    },\n    async handleRefresh() {\n      if (this.isRefreshing) return\n      this.isRefreshing = true\n      await this.fetchBookings({ silent: true })\n      setTimeout(() => {\n        this.isRefreshing = false\n      }, 200)\n    },\n    setStatus(value) {\n      this.statusFilter = value\n    },\n    formatDateKey(ts) {\n      const date = new Date(Number(ts))\n      if (Number.isNaN(date.getTime())) return '未知日期'\n      const m = `${date.getMonth() + 1}`.padStart(2, '0')\n      const d = `${date.getDate()}`.padStart(2, '0')\n      return `${date.getFullYear()}-${m}-${d}`\n    },\n    formatGroupDate(key) {\n      if (key === '未知日期') return key\n      const [y, m, d] = key.split('-')\n      return `${Number(m)}月${Number(d)}日 · ${y}`\n    },\n    formatTime(ts) {\n      if (!ts) return '--:--'\n      const date = new Date(Number(ts))\n      if (Number.isNaN(date.getTime())) return '--:--'\n      const h = `${date.getHours()}`.padStart(2, '0')\n      const m = `${date.getMinutes()}`.padStart(2, '0')\n      return `${h}:${m}`\n    },\n    statusLabel(status) {\n      const map = { scheduled: '待到店', completed: '已完成', canceled: '已取消' }\n      return map[status] || map.scheduled\n    },\n    statusClass(status) {\n      return {\n        scheduled: 'scheduled',\n        completed: 'completed',\n        canceled: 'canceled'\n      }[status] || 'scheduled'\n    },\n    goCustomerDetail(item) {\n      const cid = item?.customer_id || item?.customerId\n      if (!cid) return\n      uni.navigateTo({ url: `/pages/my-customers/detail?id=${cid}` })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.page { min-height:100vh; background:#f7f7f9; display:flex; flex-direction:column; }\n.header { padding:16px; }\n.title { font-size:20px; font-weight:600; color:#1c1c1e; }\n.filters { margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; }\n.filter-pill { padding:6px 14px; border-radius:20px; background:#fff; color:#6f6f73; font-size:13px; box-shadow:0 2px 8px rgba(0,0,0,0.04); }\n.filter-pill.active { background:#caa265; color:#fff; }\n.content { flex:1; padding:0 16px 16px; box-sizing:border-box; }\n.placeholder { margin-top:60px; text-align:center; color:#a1a1a6; }\n.group-list { display:flex; flex-direction:column; gap:18px; }\n.group-title { font-size:14px; color:#6f6f73; margin-bottom:8px; }\n.booking-card { background:#fff; border-radius:20px; padding:14px 16px; display:flex; align-items:center; box-shadow:0 4px 14px rgba(0,0,0,0.04); }\n.time { width:70px; }\n.time-main { font-size:18px; font-weight:600; color:#111; display:block; }\n.time-sub { font-size:12px; color:#a1a1a6; }\n.info { flex:1; margin-left:12px; }\n.info-title { font-size:15px; font-weight:600; color:#1c1c1e; }\n.info-sub { font-size:12px; color:#6f6f73; margin-top:4px; }\n.status-pill { padding:4px 12px; border-radius:999px; font-size:12px; font-weight:600; border:1px solid transparent; }\n.status-pill.scheduled { color:#caa265; border-color:#f0dac0; background:rgba(202,162,101,0.08); }\n.status-pill.completed { color:#20c997; border-color:rgba(32,201,151,0.3); background:rgba(32,201,151,0.08); }\n.status-pill.canceled { color:#8e8e93; border-color:#dcdce0; background:#f5f5f7; }\n</style>\n","import MiniProgramPage from '/Users/zhouzhongwei/Documents/HBuilderProjects/be-crm-main/pages/bookings/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["listTodayBookings","uni"],"mappings":"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"}