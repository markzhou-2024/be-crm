{"version":3,"file":"index.js","sources":["pages/home/index.vue","pages/home/index.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view class=\"greet-row\">\n      <view class=\"greet\">今天也要加油哦 ✨</view>\n      <view class=\"month-chip\">{{ displayMonth }}</view>\n    </view>\n\n    <view class=\"calendar-card\">\n      <view class=\"calendar-top\">\n        <button class=\"nav-btn\" @tap=\"changeMonth(-1)\">‹</button>\n        <view class=\"month-title\">{{ displayMonth }}</view>\n        <button class=\"nav-btn\" @tap=\"changeMonth(1)\">›</button>\n      </view>\n      <view class=\"week-row\">\n        <text v-for=\"day in weekLabels\" :key=\"day\">{{ day }}</text>\n      </view>\n      <view class=\"day-grid\">\n        <view\n          v-for=\"day in calendarDays\"\n          :key=\"day.date\"\n          class=\"day-cell\"\n          :class=\"{ dim: !day.inMonth, today: day.isToday, selected: day.date === selectedDate }\"\n          @tap=\"selectDate(day)\"\n          @longpress=\"quickCreate(day)\"\n        >\n          <text class=\"day-num\">{{ day.day }}</text>\n          <view class=\"task-count\" v-if=\"day.count\">{{ day.count }}</view>\n        </view>\n      </view>\n      <text class=\"calendar-hint\">点击日期切换，再次点击或长按单元格可新建任务</text>\n    </view>\n\n    <view class=\"tasks-section\">\n      <section-header :title=\"selectedDateLabel\" linkText=\"新建任务\" @more=\"openTaskForm()\" />\n      <app-card :padding=\"'0'\">\n        <view v-if=\"!dayTasks.length\" class=\"empty\">这天还没有安排，点击「新建任务」开始规划吧</view>\n        <view v-for=\"task in dayTasks\" :key=\"task.id\" class=\"task-item\">\n          <view class=\"task-main\">\n            <text class=\"task-time\">{{ task.time }}</text>\n            <view class=\"task-body\">\n              <text class=\"task-title\">{{ task.title }}</text>\n              <text v-if=\"task.note\" class=\"task-note\">{{ task.note }}</text>\n            </view>\n          </view>\n          <view class=\"task-ops\">\n            <button class=\"ghost\" @tap=\"editTask(task)\">编辑</button>\n            <button class=\"danger\" @tap=\"removeTask(task)\">删除</button>\n          </view>\n        </view>\n      </app-card>\n    </view>\n\n    <view v-if=\"formVisible\" class=\"form-mask\">\n      <view class=\"form-card\">\n        <view class=\"form-title\">{{ editingTaskId ? '编辑任务' : '创建任务' }}</view>\n        <view class=\"form-field\">\n          <text class=\"field-label\">日期</text>\n          <text class=\"field-value\">{{ selectedDate }}</text>\n        </view>\n        <view class=\"form-field\">\n          <text class=\"field-label\">标题</text>\n          <input class=\"field-input\" type=\"text\" v-model=\"formData.title\" placeholder=\"请输入任务名称\" />\n        </view>\n        <view class=\"form-field\">\n          <text class=\"field-label\">时间</text>\n          <picker mode=\"time\" :value=\"formData.time\" @change=\"onTimeChange\">\n            <view class=\"picker-value\">{{ formData.time }}</view>\n          </picker>\n        </view>\n        <view class=\"form-field\">\n          <text class=\"field-label\">备注</text>\n          <textarea class=\"field-textarea\" v-model=\"formData.note\" placeholder=\"可填写提醒内容\"></textarea>\n        </view>\n        <view class=\"form-actions\">\n          <button class=\"ghost\" @tap=\"closeForm\">取消</button>\n          <button class=\"primary\" @tap=\"submitTask\">{{ editingTaskId ? '保存' : '创建' }}</button>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nconst pad = (value) => `${value}`.padStart(2, '0')\nfunction formatDateValue (date) {\n  const d = new Date(date)\n  const y = d.getFullYear()\n  return `${y}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`\n}\nfunction formatMonthValue (date) {\n  const d = new Date(date)\n  return `${d.getFullYear()}-${pad(d.getMonth() + 1)}`\n}\n\nimport AppCard from '@/src/components/ui/AppCard.vue'\nimport SectionHeader from '@/src/components/ui/SectionHeader.vue'\nimport { listAllTasks, listTasksByDate, createTask, updateTask, deleteTask } from '@/src/services/schedule.js'\n\nexport default {\n  name: 'HomePage',\n  components: { AppCard, SectionHeader },\n  data () {\n    const today = formatDateValue(new Date())\n    return {\n      weekLabels: ['一', '二', '三', '四', '五', '六', '日'],\n      currentMonth: formatMonthValue(new Date()),\n      displayMonth: '',\n      calendarDays: [],\n      selectedDate: today,\n      dayTasks: [],\n      allTasks: [],\n      formVisible: false,\n      formData: { title: '', time: '09:00', note: '' },\n      editingTaskId: ''\n    }\n  },\n  async onShow () {\n    await this.refreshTasks()\n  },\n  methods: {\n    formatDate (date) {\n      return formatDateValue(date)\n    },\n    formatMonth (date) {\n      return formatMonthValue(date)\n    },\n    async refreshTasks () {\n      this.allTasks = await listAllTasks()\n      this.buildCalendar()\n      await this.loadDayTasks()\n    },\n    buildCalendar () {\n      const [year, month] = this.currentMonth.split('-').map(n => Number(n))\n      const firstDay = new Date(year, month - 1, 1)\n      const start = new Date(firstDay)\n      const offset = (firstDay.getDay() + 6) % 7\n      start.setDate(firstDay.getDate() - offset)\n      const today = this.formatDate(new Date())\n      const countMap = this.allTasks.reduce((acc, task) => {\n        acc[task.date] = (acc[task.date] || 0) + 1\n        return acc\n      }, {})\n      const days = []\n      for (let i = 0; i < 42; i += 1) {\n        const current = new Date(start)\n        current.setDate(start.getDate() + i)\n        const dateStr = this.formatDate(current)\n        days.push({\n          date: dateStr,\n          day: current.getDate(),\n          inMonth: current.getMonth() === (month - 1) && current.getFullYear() === year,\n          isToday: dateStr === today,\n          count: countMap[dateStr] || 0\n        })\n      }\n      this.displayMonth = `${year}年${String(month).padStart(2, '0')}月`\n      this.calendarDays = days\n      if (this.selectedDate.slice(0, 7) !== this.currentMonth) {\n        this.selectedDate = this.formatDate(new Date(year, month - 1, 1))\n      }\n    },\n    async loadDayTasks () {\n      this.dayTasks = await listTasksByDate(this.selectedDate)\n    },\n    changeMonth (step) {\n      const [year, month] = this.currentMonth.split('-').map(n => Number(n))\n      const next = new Date(year, month - 1 + step, 1)\n      this.currentMonth = this.formatMonth(next)\n      this.buildCalendar()\n      this.loadDayTasks()\n    },\n    async selectDate (day) {\n      const same = this.selectedDate === day.date\n      this.selectedDate = day.date\n      await this.loadDayTasks()\n      if (same) {\n        this.openTaskForm()\n      }\n    },\n    quickCreate (day) {\n      this.selectedDate = day.date\n      this.loadDayTasks()\n      this.openTaskForm()\n    },\n    openTaskForm (task) {\n      this.formVisible = true\n      if (task) {\n        this.editingTaskId = task.id\n        this.formData = { title: task.title, time: task.time, note: task.note || '' }\n      } else {\n        this.editingTaskId = ''\n        this.formData = { title: '', time: '09:00', note: '' }\n      }\n    },\n    closeForm () {\n      this.formVisible = false\n      this.editingTaskId = ''\n    },\n    onTimeChange (e) {\n      this.formData.time = e?.detail?.value || this.formData.time\n    },\n    async submitTask () {\n      const title = (this.formData.title || '').trim()\n      if (!title) {\n        uni.showToast({ title: '请输入任务名称', icon: 'none' })\n        return\n      }\n      const payload = {\n        title,\n        time: this.formData.time || '09:00',\n        note: (this.formData.note || '').trim(),\n        date: this.selectedDate\n      }\n      const editing = !!this.editingTaskId\n      if (editing) {\n        await updateTask(this.editingTaskId, payload)\n      } else {\n        await createTask(payload)\n      }\n      this.closeForm()\n      await this.refreshTasks()\n      uni.showToast({ title: editing ? '已更新' : '已创建', icon: 'none' })\n    },\n    editTask (task) {\n      this.openTaskForm(task)\n    },\n    removeTask (task) {\n      uni.showModal({\n        title: '删除任务',\n        content: `确定删除「${task.title}」吗？`,\n        success: async res => {\n          if (res.confirm) {\n            await deleteTask(task.id)\n            await this.refreshTasks()\n            uni.showToast({ title: '已删除', icon: 'none' })\n          }\n        }\n      })\n    }\n  },\n  computed: {\n    selectedDateLabel () {\n      if (!this.selectedDate) return '任务列表'\n      const dateObj = new Date(this.selectedDate.replace(/-/g, '/'))\n      const weekTexts = ['周日', '周一', '周二', '周三', '周四', '周五', '周六']\n      const month = `${dateObj.getMonth() + 1}`.toString().padStart(2, '0')\n      const day = `${dateObj.getDate()}`.toString().padStart(2, '0')\n      return `${month}月${day}日 · ${weekTexts[dateObj.getDay()]}`\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.page { min-height:100vh; background:#F7F7F7; padding:16px; box-sizing:border-box; }\n.greet-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }\n.greet { color:#111; font-weight:600; font-size:18px; }\n.month-chip { font-size:13px; color:#6f6f73; padding:4px 10px; border-radius:16px; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,0.05); }\n.calendar-card { background:#fff; border-radius:28px; padding:18px; box-shadow:0 12px 30px rgba(0,0,0,0.06); margin-bottom:20px; }\n.calendar-top { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }\n.month-title { font-size:18px; font-weight:600; color:#111; }\n.nav-btn { width:36px; height:36px; border-radius:18px; background:#f7f7f7; border:none; font-size:20px; line-height:36px; text-align:center; color:#caa265; box-shadow:0 6px 16px rgba(0,0,0,0.08); }\n.nav-btn::after,\n.task-ops button::after,\n.form-actions button::after { border:none; }\n.week-row { display:grid; grid-template-columns:repeat(7,1fr); text-align:center; font-size:12px; color:#8e8e93; margin-bottom:8px; }\n.day-grid { display:grid; grid-template-columns:repeat(7,1fr); grid-gap:12px 6px; }\n.day-cell { min-height:56px; border-radius:18px; padding:6px; position:relative; display:flex; flex-direction:column; align-items:flex-start; justify-content:flex-start; }\n.day-cell.dim .day-num { color:#c0c0c8; }\n.day-cell.today { border:1px dashed #caa265; }\n.day-cell.selected { border:1px solid #caa265; background:rgba(202,162,101,0.08); }\n.day-num { font-size:15px; font-weight:600; color:#1c1c1e; }\n.task-count { position:absolute; right:6px; bottom:6px; min-width:20px; height:20px; border-radius:10px; font-size:12px; line-height:20px; text-align:center; background:#caa265; color:#fff; padding:0 6px; }\n.calendar-hint { display:block; margin-top:10px; font-size:12px; color:#8e8e93; text-align:center; }\n.tasks-section { margin-bottom:24px; }\n.empty { text-align:center; color:#6F6F73; font-size:13px; padding:22px 0; }\n.task-item { display:flex; flex-direction:column; padding:14px 16px; border-bottom:1px solid #f0f0f0; }\n.task-item:last-child { border-bottom:none; }\n.task-main { display:flex; gap:12px; align-items:flex-start; }\n.task-time { font-size:16px; font-weight:600; color:#caa265; min-width:60px; }\n.task-body { flex:1; }\n.task-title { font-size:15px; color:#1c1c1e; font-weight:500; }\n.task-note { font-size:13px; color:#6f6f73; margin-top:4px; display:block; }\n.task-ops { display:flex; justify-content:flex-end; gap:8px; margin-top:10px; }\n.task-ops button { font-size:13px; padding:6px 14px; border-radius:16px; border:none; }\n.task-ops .ghost { background:#f5f5f5; color:#1c1c1e; }\n.task-ops .danger { background:#ffe8e6; color:#e66; }\n.form-mask { position:fixed; left:0; top:0; right:0; bottom:0; background:rgba(0,0,0,0.45); display:flex; align-items:flex-end; padding:16px; z-index:99; }\n.form-card { width:100%; background:#fff; border-radius:24px 24px 12px 12px; padding:20px; box-shadow:0 -8px 24px rgba(0,0,0,0.1); }\n.form-title { font-size:16px; font-weight:600; margin-bottom:14px; text-align:center; color:#111; }\n.form-field { margin-bottom:14px; }\n.form-field:last-of-type { margin-bottom:18px; }\n.field-label { font-size:13px; color:#6f6f73; margin-bottom:4px; display:block; }\n.field-value { font-size:15px; color:#1c1c1e; }\n.field-input, .field-textarea { width:100%; border:1px solid #ededed; border-radius:16px; padding:12px; font-size:14px; box-sizing:border-box; background:#fafafa; }\n.field-textarea { min-height:80px; }\n.picker-value { width:100%; border:1px solid #ededed; border-radius:16px; padding:12px; font-size:14px; color:#1c1c1e; background:#fafafa; }\n.form-actions { display:flex; gap:12px; }\n.form-actions button { flex:1; border:none; border-radius:22px; padding:12px 0; font-size:15px; }\n.form-actions .ghost { background:#f5f5f5; color:#1c1c1e; }\n.form-actions .primary { background:#caa265; color:#fff; }\n</style>\n","import MiniProgramPage from '/Users/zhouzhongwei/Documents/HBuilderProjects/be-crm-main/pages/home/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["listAllTasks","listTasksByDate","uni","updateTask","createTask","deleteTask"],"mappings":"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"}