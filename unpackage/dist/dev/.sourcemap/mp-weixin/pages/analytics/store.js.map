{"version":3,"file":"store.js","sources":["pages/analytics/store.vue","pages/analytics/store.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view class=\"filters\">\n      <picker class=\"picker\" mode=\"selector\" :range=\"storeOptions\" range-key=\"label\" :value=\"storeIndex\" @change=\"onStoreChange\">\n        <view class=\"picker-trigger\">{{ currentStoreLabel }}</view>\n      </picker>\n      <view class=\"month-switch\">\n        <button class=\"nav-btn\" @tap=\"changeMonth(-1)\">‹</button>\n        <text class=\"month-label\">{{ currentMonth }}</text>\n        <button class=\"nav-btn\" @tap=\"changeMonth(1)\">›</button>\n      </view>\n    </view>\n\n    <view class=\"cards\">\n      <view class=\"kpi-card\" v-for=\"card in cards\" :key=\"card.key\">\n        <text class=\"kpi-label\">{{ card.label }}</text>\n        <text class=\"kpi-value\">{{ formatValue(card.value, card.format) }}</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\n// @ts-nocheck\nimport { fetchShops } from '@/api/shops.js'\nimport { fetchStoreMonthlyKPI } from '@/api/analytics.js'\n\nexport default {\n  data() {\n    return {\n      storeOptions: [],\n      storeIndex: 0,\n      currentMonth: this.formatMonth(new Date()),\n      kpi: {\n        arrive_customer_distinct: 0,\n        service_count: 0,\n        consume_amount: 0\n      }\n    }\n  },\n  computed: {\n    currentStoreLabel() {\n      const option = this.storeOptions[this.storeIndex]\n      return option ? option.label : '选择门店'\n    },\n    cards() {\n      return [\n        { key: 'arrive', label: '到客数量', value: this.kpi.arrive_customer_distinct },\n        { key: 'service', label: '服务次数', value: this.kpi.service_count },\n        { key: 'amount', label: '总消耗金额(元)', value: this.kpi.consume_amount, format: 'amount' }\n      ]\n    }\n  },\n  async onShow() {\n    await this.ensureStores()\n    await this.loadKPI()\n  },\n  methods: {\n    formatMonth(date) {\n      const d = new Date(date)\n      const y = d.getFullYear()\n      const m = `${d.getMonth() + 1}`.padStart(2, '0')\n      return `${y}-${m}`\n    },\n    async ensureStores() {\n      if (this.storeOptions.length) return\n      try {\n        const list = await fetchShops()\n        this.storeOptions = list.map(item => ({ label: item.name, value: item._id || item.id }))\n      } catch (err) {\n        uni.showToast({ title: '门店加载失败', icon: 'none' })\n      }\n    },\n    async loadKPI() {\n      if (!this.storeOptions.length) return\n      const storeId = this.storeOptions[this.storeIndex]?.value\n      if (!storeId) {\n        uni.showToast({ title: '请选择门店', icon: 'none' })\n        return\n      }\n      try {\n        const data = await fetchStoreMonthlyKPI({ store_id: storeId, month: this.currentMonth })\n        this.kpi = data || this.kpi\n      } catch (err) {\n        uni.showToast({ title: err?.message || '加载失败', icon: 'none' })\n      }\n    },\n    onStoreChange(e) {\n      this.storeIndex = Number(e?.detail?.value || 0)\n      this.loadKPI()\n    },\n    changeMonth(step) {\n      const [year, month] = this.currentMonth.split('-').map(num => Number(num))\n      const next = new Date(year, month - 1 + step, 1)\n      this.currentMonth = this.formatMonth(next)\n      this.loadKPI()\n    },\n    formatValue(value, format) {\n      if (format === 'amount') {\n        return Number(value || 0).toFixed(2)\n      }\n      return Number(value || 0).toLocaleString('zh-CN')\n    }\n  }\n}\n</script>\n\n<style scoped>\n.page { min-height:100vh; background:#f6f7f9; padding:16px; box-sizing:border-box; }\n.filters { display:flex; flex-direction:column; gap:12px; margin-bottom:16px; }\n.picker-trigger { background:#fff; border-radius:18px; padding:14px; box-shadow:0 8px 18px rgba(0,0,0,0.06); }\n.month-switch { display:flex; align-items:center; justify-content:center; gap:12px; }\n.nav-btn { width:40px; height:40px; border-radius:20px; background:#fff; box-shadow:0 6px 18px rgba(0,0,0,0.08); text-align:center; line-height:40px; font-size:20px; color:#caa265; }\n.month-label { font-size:18px; font-weight:600; color:#1c1c1e; }\n.cards { display:flex; flex-direction:column; gap:16px; }\n.kpi-card { background:#fff; border-radius:24px; padding:20px; box-shadow:0 12px 30px rgba(0,0,0,0.06); }\n.kpi-label { font-size:14px; color:#8e8e93; }\n.kpi-value { display:block; margin-top:10px; font-size:28px; font-weight:700; color:#1c1c1e; }\n</style>\n","import MiniProgramPage from '/Users/zhouzhongwei/Documents/HBuilderProjects/be-crm-main/pages/analytics/store.vue'\nwx.createPage(MiniProgramPage)"],"names":["fetchShops","uni","fetchStoreMonthlyKPI"],"mappings":";;;;AA2BA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,cAAc,CAAE;AAAA,MAChB,YAAY;AAAA,MACZ,cAAc,KAAK,YAAY,oBAAI,KAAI,CAAE;AAAA,MACzC,KAAK;AAAA,QACH,0BAA0B;AAAA,QAC1B,eAAe;AAAA,QACf,gBAAgB;AAAA,MAClB;AAAA,IACF;AAAA,EACD;AAAA,EACD,UAAU;AAAA,IACR,oBAAoB;AAClB,YAAM,SAAS,KAAK,aAAa,KAAK,UAAU;AAChD,aAAO,SAAS,OAAO,QAAQ;AAAA,IAChC;AAAA,IACD,QAAQ;AACN,aAAO;AAAA,QACL,EAAE,KAAK,UAAU,OAAO,QAAQ,OAAO,KAAK,IAAI,yBAA0B;AAAA,QAC1E,EAAE,KAAK,WAAW,OAAO,QAAQ,OAAO,KAAK,IAAI,cAAe;AAAA,QAChE,EAAE,KAAK,UAAU,OAAO,YAAY,OAAO,KAAK,IAAI,gBAAgB,QAAQ,SAAS;AAAA,MACvF;AAAA,IACF;AAAA,EACD;AAAA,EACD,MAAM,SAAS;AACb,UAAM,KAAK,aAAa;AACxB,UAAM,KAAK,QAAQ;AAAA,EACpB;AAAA,EACD,SAAS;AAAA,IACP,YAAY,MAAM;AAChB,YAAM,IAAI,IAAI,KAAK,IAAI;AACvB,YAAM,IAAI,EAAE,YAAY;AACxB,YAAM,IAAI,GAAG,EAAE,SAAQ,IAAK,CAAC,GAAG,SAAS,GAAG,GAAG;AAC/C,aAAO,GAAG,CAAC,IAAI,CAAC;AAAA,IACjB;AAAA,IACD,MAAM,eAAe;AACnB,UAAI,KAAK,aAAa;AAAQ;AAC9B,UAAI;AACF,cAAM,OAAO,MAAMA,qBAAW;AAC9B,aAAK,eAAe,KAAK,IAAI,WAAS,EAAE,OAAO,KAAK,MAAM,OAAO,KAAK,OAAO,KAAK,GAAI,EAAC;AAAA,MACvF,SAAO,KAAK;AACZC,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAAA,MACjD;AAAA,IACD;AAAA,IACD,MAAM,UAAU;;AACd,UAAI,CAAC,KAAK,aAAa;AAAQ;AAC/B,YAAM,WAAU,UAAK,aAAa,KAAK,UAAU,MAAjC,mBAAoC;AACpD,UAAI,CAAC,SAAS;AACZA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAC9C;AAAA,MACF;AACA,UAAI;AACF,cAAM,OAAO,MAAMC,cAAAA,qBAAqB,EAAE,UAAU,SAAS,OAAO,KAAK,cAAc;AACvF,aAAK,MAAM,QAAQ,KAAK;AAAA,MACxB,SAAO,KAAK;AACZD,4BAAI,UAAU,EAAE,QAAO,2BAAK,YAAW,QAAQ,MAAM,QAAQ;AAAA,MAC/D;AAAA,IACD;AAAA,IACD,cAAc,GAAG;;AACf,WAAK,aAAa,SAAO,4BAAG,WAAH,mBAAW,UAAS,CAAC;AAC9C,WAAK,QAAQ;AAAA,IACd;AAAA,IACD,YAAY,MAAM;AAChB,YAAM,CAAC,MAAM,KAAK,IAAI,KAAK,aAAa,MAAM,GAAG,EAAE,IAAI,SAAO,OAAO,GAAG,CAAC;AACzE,YAAM,OAAO,IAAI,KAAK,MAAM,QAAQ,IAAI,MAAM,CAAC;AAC/C,WAAK,eAAe,KAAK,YAAY,IAAI;AACzC,WAAK,QAAQ;AAAA,IACd;AAAA,IACD,YAAY,OAAO,QAAQ;AACzB,UAAI,WAAW,UAAU;AACvB,eAAO,OAAO,SAAS,CAAC,EAAE,QAAQ,CAAC;AAAA,MACrC;AACA,aAAO,OAAO,SAAS,CAAC,EAAE,eAAe,OAAO;AAAA,IAClD;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;ACvGA,GAAG,WAAW,eAAe;"}