{"version":3,"file":"edit.js","sources":["pages/my-customers/edit.vue","../../../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXktY3VzdG9tZXJzL2VkaXQudnVl"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <scroll-view class=\"form\" scroll-y>\n      <view class=\"field required\">\n        <text class=\"label\">姓名</text>\n        <input class=\"input\" v-model=\"form.name\" placeholder=\"请输入客户姓名\" />\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">手机号</text>\n        <input class=\"input\" v-model=\"form.phone\" type=\"number\" maxlength=\"11\" placeholder=\"请输入手机号\" />\n      </view>\n\n      <view class=\"field switch-field\">\n        <text class=\"label\">VIP 客户</text>\n        <switch :checked=\"form.is_vip\" @change=\"onVipChange\" color=\"#caa265\" />\n      </view>\n\n      <view class=\"field required\">\n        <text class=\"label\">归属门店</text>\n        <picker :range=\"shopOptions\" range-key=\"label\" @change=\"onPickShop\">\n          <view class=\"picker-trigger\">\n            {{ form.store_name || '请选择门店' }}\n          </view>\n        </picker>\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">头像 URL</text>\n        <input class=\"input\" v-model=\"form.avatar\" placeholder=\"https://example.com/avatar.jpg\" />\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">标签</text>\n        <input class=\"input\" v-model=\"form.tags\" placeholder=\"例：年卡, 精油\" />\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">城市</text>\n        <input class=\"input\" v-model=\"form.city\" placeholder=\"例：上海\" />\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">备注</text>\n        <textarea class=\"textarea\" v-model=\"form.notes\" placeholder=\"可记录偏好、注意事项\" />\n      </view>\n    </scroll-view>\n\n    <view class=\"actions\">\n      <button class=\"btn primary\" :loading=\"submitting\" @tap=\"submit\">保存</button>\n    </view>\n  </view>\n</template>\n\n<script>\n// @ts-nocheck\nimport { getCustomerById, updateCustomer } from '@/api/customers.js'\nimport { fetchShops } from '@/api/shops.js'\n\nexport default {\n  data() {\n    return {\n      id: '',\n      submitting: false,\n      shopOptions: [],\n      form: {\n        _id: '',\n        name: '',\n        phone: '',\n        is_vip: false,\n        avatar: '',\n        tags: '',\n        city: '',\n        notes: '',\n        store_id: '',\n        store_name: ''\n      }\n    }\n  },\n  async onLoad(query) {\n    this.id = (query && query.id) || ''\n    if (!this.id) {\n      uni.showToast({ title: '缺少客户ID', icon: 'none' })\n      setTimeout(() => uni.navigateBack(), 400)\n      return\n    }\n    await this.initShops()\n    this.loadData()\n  },\n  methods: {\n    async initShops() {\n      try {\n        const shops = await fetchShops()\n        this.shopOptions = shops.map(s => ({\n          value: s._id,\n          label: s.store_name || '未命名门店'\n        }))\n      } catch (err) {\n        uni.showToast({ title: err?.errMsg || err?.message || '加载门店失败', icon: 'none' })\n        this.shopOptions = []\n      }\n    },\n    async loadData() {\n      try {\n        const data = await getCustomerById(this.id)\n        if (!data) {\n          uni.showToast({ title: '客户不存在', icon: 'none' })\n          setTimeout(() => uni.navigateBack(), 400)\n          return\n        }\n        if (!data.store_name && data.store_id) {\n          const match = this.shopOptions.find(opt => opt.value === data.store_id)\n          if (match) data.store_name = match.label\n        }\n        this.form = { ...data }\n      } catch (err) {\n        uni.showToast({ title: err?.errMsg || err?.message || '加载失败', icon: 'none' })\n      }\n    },\n    onVipChange(e) {\n      this.form.is_vip = !!e.detail.value\n    },\n    onPickShop(e) {\n      const idx = Number(e.detail.value)\n      const opt = this.shopOptions[idx]\n      if (opt) {\n        this.form.store_id = opt.value\n        this.form.store_name = opt.label\n      }\n    },\n    validate() {\n      const name = (this.form.name || '').trim()\n      const phone = (this.form.phone || '').trim()\n      if (!name) {\n        uni.showToast({ title: '请填写姓名', icon: 'none' })\n        return false\n      }\n      if (phone && !/^1\\d{10}$/.test(phone)) {\n        uni.showToast({ title: '手机号格式错误', icon: 'none' })\n        return false\n      }\n      if (!this.form.store_id) {\n        uni.showToast({ title: '请选择归属门店', icon: 'none' })\n        return false\n      }\n      this.form.name = name\n      this.form.phone = phone\n      return true\n    },\n    async submit() {\n      if (this.submitting) return\n      if (!this.validate()) return\n      this.submitting = true\n      try {\n        await updateCustomer(this.form)\n        uni.showToast({ title: '保存成功', icon: 'success' })\n        setTimeout(() => uni.navigateBack(), 400)\n      } catch (err) {\n        uni.showToast({ title: err?.errMsg || err?.message || '保存失败', icon: 'none' })\n      } finally {\n        this.submitting = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.page { min-height:100vh; background:#f6f7f9; display:flex; flex-direction:column; }\n.form { flex:1; padding:16px; box-sizing:border-box; }\n.field { margin-bottom:14px; background:#fff; border-radius:16px; padding:12px 14px; box-shadow:0 2px 8px rgba(0,0,0,0.03); }\n.field.required .label::after { content:'*'; color:#dd524d; margin-left:4px; }\n.label { display:block; font-size:13px; color:#9a9aa0; margin-bottom:6px; }\n.input { font-size:15px; color:#333; }\n.picker-trigger { font-size:15px; color:#333; min-height:22px; }\n.textarea { width:100%; min-height:96px; font-size:15px; color:#333; }\n.switch-field { display:flex; align-items:center; justify-content:space-between; }\n.actions { padding:12px 16px 24px; }\n.btn { height:46px; border-radius:24px; font-size:16px; }\n.primary { background:#caa265; color:#fff; }\n</style>\n","import MiniProgramPage from 'D:/移动云盘同步盘/hua-应用/be-crm/be-crm/be-crm/pages/my-customers/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","query","uni","shops","fetchShops","err","data","getCustomerById","match","opt","e","idx","name","phone","updateCustomer","MiniProgramPage"],"mappings":"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"}