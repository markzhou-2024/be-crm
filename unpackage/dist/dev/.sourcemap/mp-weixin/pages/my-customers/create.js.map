{"version":3,"file":"create.js","sources":["pages/my-customers/create.vue","../../../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXktY3VzdG9tZXJzL2NyZWF0ZS52dWU"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <scroll-view class=\"form\" scroll-y>\n      <view class=\"field required\">\n        <text class=\"label\">姓名</text>\n        <input class=\"input\" v-model=\"form.name\" placeholder=\"请输入客户姓名\" />\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">手机号</text>\n        <input class=\"input\" v-model=\"form.phone\" type=\"number\" maxlength=\"11\" placeholder=\"请输入手机号\" />\n      </view>\n\n      <view class=\"field switch-field\">\n        <text class=\"label\">VIP 客户</text>\n        <switch :checked=\"form.is_vip\" @change=\"onVipChange\" color=\"#caa265\" />\n      </view>\n\n      <view class=\"field required\">\n        <text class=\"label\">归属门店</text>\n        <picker :range=\"shopOptions\" range-key=\"label\" @change=\"onPickShop\">\n          <view class=\"picker-trigger\">\n            {{ form.store_name || '请选择门店' }}\n          </view>\n        </picker>\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">头像 URL</text>\n        <input class=\"input\" v-model=\"form.avatar\" placeholder=\"https://example.com/avatar.jpg\" />\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">标签</text>\n        <input class=\"input\" v-model=\"form.tags\" placeholder=\"例：年卡, 精油\" />\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">城市</text>\n        <input class=\"input\" v-model=\"form.city\" placeholder=\"例：上海\" />\n      </view>\n\n      <view class=\"field\">\n        <text class=\"label\">备注</text>\n        <textarea class=\"textarea\" v-model=\"form.notes\" placeholder=\"可记录偏好、注意事项\" />\n      </view>\n    </scroll-view>\n\n    <view class=\"actions\">\n      <button class=\"btn primary\" :loading=\"submitting\" @tap=\"submit\">保存</button>\n    </view>\n  </view>\n</template>\n\n<script>\n// @ts-nocheck\nimport { createCustomer } from '@/api/customers.js'\nimport { fetchShops } from '@/api/shops.js'\n\nexport default {\n  data() {\n    return {\n      submitting: false,\n      shopOptions: [],\n      form: {\n        name: '',\n        phone: '',\n        is_vip: false,\n        avatar: '',\n        tags: '',\n        city: '',\n        notes: '',\n        store_id: '',\n        store_name: ''\n      }\n    }\n  },\n  async onLoad() {\n    await this.initShops()\n  },\n  methods: {\n    async initShops() {\n      try {\n        const shops = await fetchShops()\n        if (!shops.length) {\n          uni.showToast({ title: '请先创建门店', icon: 'none' })\n        }\n        this.shopOptions = shops.map(s => ({\n        value: s._id,\n        label: s.store_name || '未命名门店'\n      }))\n      } catch (err) {\n        uni.showToast({ title: err?.errMsg || err?.message || '加载门店失败', icon: 'none' })\n        this.shopOptions = []\n      }\n    },\n    onVipChange(e) {\n      this.form.is_vip = !!e.detail.value\n    },\n    onPickShop(e) {\n      const idx = Number(e.detail.value)\n      const opt = this.shopOptions[idx]\n      if (opt) {\n        this.form.store_id = opt.value\n        this.form.store_name = opt.label\n      }\n    },\n    validate() {\n      const name = (this.form.name || '').trim()\n      const phone = (this.form.phone || '').trim()\n      if (!name) {\n        uni.showToast({ title: '请填写姓名', icon: 'none' })\n        return false\n      }\n      if (phone && !/^1\\d{10}$/.test(phone)) {\n        uni.showToast({ title: '手机号格式错误', icon: 'none' })\n        return false\n      }\n      if (!this.form.store_id) {\n        uni.showToast({ title: '请选择归属门店', icon: 'none' })\n        return false\n      }\n      this.form.name = name\n      this.form.phone = phone\n      return true\n    },\n    async submit() {\n      if (this.submitting) return\n      if (!this.validate()) return\n      this.submitting = true\n      const payload = {\n        name: this.form.name,\n        phone: this.form.phone,\n        is_vip: this.form.is_vip,\n        avatar: this.form.avatar,\n        tags: this.form.tags,\n        city: this.form.city,\n        notes: this.form.notes,\n        store_id: this.form.store_id,\n        store_name: this.form.store_name,\n        total_spend: 0,\n        visit_count: 0,\n        last_visit_days: 0,\n        last_visit_label: '今天'\n      }\n      try {\n        await createCustomer(payload)\n        uni.showToast({ title: '创建成功', icon: 'success' })\n        setTimeout(() => uni.navigateBack(), 400)\n      } catch (err) {\n        uni.showToast({ title: err?.errMsg || err?.message || '保存失败', icon: 'none' })\n      } finally {\n        this.submitting = false\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.page { min-height:100vh; background:#f6f7f9; display:flex; flex-direction:column; }\n.form { flex:1; padding:16px; box-sizing:border-box; }\n.field { margin-bottom:14px; background:#fff; border-radius:16px; padding:12px 14px; box-shadow:0 2px 8px rgba(0,0,0,0.03); }\n.field.required .label::after { content:'*'; color:#dd524d; margin-left:4px; }\n.label { display:block; font-size:13px; color:#9a9aa0; margin-bottom:6px; }\n.input { font-size:15px; color:#333; }\n.picker-trigger { font-size:15px; color:#333; min-height:22px; }\n.textarea { width:100%; min-height:96px; font-size:15px; color:#333; }\n.switch-field { display:flex; align-items:center; justify-content:space-between; }\n.actions { padding:12px 16px 24px; }\n.btn { height:46px; border-radius:24px; font-size:16px; }\n.primary { background:#caa265; color:#fff; }\n</style>\n","import MiniProgramPage from 'D:/移动云盘同步盘/hua-应用/be-crm/be-crm/be-crm/pages/my-customers/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","shops","fetchShops","uni","err","e","idx","opt","name","phone","payload","createCustomer","MiniProgramPage"],"mappings":"2HA2DKA,EAAU,CACb,MAAO,CACL,MAAO,CACL,WAAY,GACZ,YAAa,CAAE,EACf,KAAM,CACJ,KAAM,GACN,MAAO,GACP,OAAQ,GACR,OAAQ,GACR,KAAM,GACN,KAAM,GACN,MAAO,GACP,SAAU,GACV,WAAY,EACd,CACF,CACD,EACD,MAAM,QAAS,CACb,MAAM,KAAK,UAAU,CACtB,EACD,QAAS,CACP,MAAM,WAAY,CAChB,GAAI,CACF,MAAMC,EAAQ,MAAMC,aAAW,EAC1BD,EAAM,QACTE,EAAG,MAAC,UAAU,CAAE,MAAO,SAAU,KAAM,OAAQ,EAEjD,KAAK,YAAcF,EAAM,IAAI,IAAM,CACnC,MAAO,EAAE,IACT,MAAO,EAAE,YAAc,OACzB,EAAE,CACA,OAAOG,EAAK,CACZD,EAAAA,MAAI,UAAU,CAAE,OAAOC,GAAA,YAAAA,EAAK,UAAUA,GAAA,YAAAA,EAAK,UAAW,SAAU,KAAM,OAAQ,EAC9E,KAAK,YAAc,CAAC,CACtB,CACD,EACD,YAAYC,EAAG,CACb,KAAK,KAAK,OAAS,CAAC,CAACA,EAAE,OAAO,KAC/B,EACD,WAAWA,EAAG,CACZ,MAAMC,EAAM,OAAOD,EAAE,OAAO,KAAK,EAC3BE,EAAM,KAAK,YAAYD,CAAG,EAC5BC,IACF,KAAK,KAAK,SAAWA,EAAI,MACzB,KAAK,KAAK,WAAaA,EAAI,MAE9B,EACD,UAAW,CACT,MAAMC,GAAQ,KAAK,KAAK,MAAQ,IAAI,KAAK,EACnCC,GAAS,KAAK,KAAK,OAAS,IAAI,KAAK,EAC3C,OAAKD,EAIDC,GAAS,CAAC,YAAY,KAAKA,CAAK,GAClCN,EAAG,MAAC,UAAU,CAAE,MAAO,UAAW,KAAM,OAAQ,EACzC,IAEJ,KAAK,KAAK,UAIf,KAAK,KAAK,KAAOK,EACjB,KAAK,KAAK,MAAQC,EACX,KALLN,EAAG,MAAC,UAAU,CAAE,MAAO,UAAW,KAAM,OAAQ,EACzC,KATPA,EAAG,MAAC,UAAU,CAAE,MAAO,QAAS,KAAM,OAAQ,EACvC,GAaV,EACD,MAAM,QAAS,CAEb,GADI,KAAK,YACL,CAAC,KAAK,SAAQ,EAAI,OACtB,KAAK,WAAa,GAClB,MAAMO,EAAU,CACd,KAAM,KAAK,KAAK,KAChB,MAAO,KAAK,KAAK,MACjB,OAAQ,KAAK,KAAK,OAClB,OAAQ,KAAK,KAAK,OAClB,KAAM,KAAK,KAAK,KAChB,KAAM,KAAK,KAAK,KAChB,MAAO,KAAK,KAAK,MACjB,SAAU,KAAK,KAAK,SACpB,WAAY,KAAK,KAAK,WACtB,YAAa,EACb,YAAa,EACb,gBAAiB,EACjB,iBAAkB,IACpB,EACA,GAAI,CACF,MAAMC,EAAAA,eAAeD,CAAO,EAC5BP,EAAG,MAAC,UAAU,CAAE,MAAO,OAAQ,KAAM,UAAW,EAChD,WAAW,IAAMA,EAAAA,MAAI,aAAY,EAAI,GAAG,CACxC,OAAOC,EAAK,CACZD,EAAAA,MAAI,UAAU,CAAE,OAAOC,GAAA,YAAAA,EAAK,UAAUA,GAAA,YAAAA,EAAK,UAAW,OAAQ,KAAM,OAAQ,CAC9E,QAAU,CACR,KAAK,WAAa,EACpB,CACF,CACF,CACF,+nBC3JA,GAAG,WAAWQ,CAAe"}