{"version":3,"file":"detail.js","sources":["pages/my-customers/detail.vue","../../../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXktY3VzdG9tZXJzL2RldGFpbC52dWU"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view class=\"edit-btn\" @tap=\"goEdit\">ÁºñËæë</view>\n    <scroll-view class=\"content\" scroll-y>\n      <view class=\"hero\">\n        <image class=\"avatar\" :src=\"customer.avatar || defaultAvatar\" mode=\"aspectFill\"></image>\n        <view class=\"info\">\n          <view class=\"name-row\">\n            <text class=\"name\">{{ customer.name }}</text>\n            <text v-if=\"customer.is_vip\" class=\"vip-pill\">VIP</text>\n          </view>\n          <view class=\"tag-row\">\n            <text v-if=\"customer.store_name\" class=\"tag\">{{ customer.store_name }}</text>\n            <text v-if=\"customer.tags\" class=\"tag\">{{ customer.tags }}</text>\n            <text class=\"city\" v-if=\"customer.city\">{{ customer.city }}</text>\n          </view>\n          <view class=\"phone-row\">\n            <text class=\"phone-icon\">üìû</text>\n            <text>{{ customer.phone || '-' }}</text>\n          </view>\n        </view>\n      </view>\n\n      <view class=\"stat-card\">\n        <view class=\"stat\">\n          <text class=\"stat-label\">Á¥ØËÆ°Ê∂àË¥π</text>\n          <text class=\"stat-value\">¬•{{ toAmount(customer.total_spend) }}</text>\n        </view>\n        <view class=\"divider\"></view>\n        <view class=\"stat\">\n          <text class=\"stat-label\">Âà∞Â∫óÊ¨°Êï∞</text>\n          <text class=\"stat-value\">{{ customer.visit_count || 0 }} Ê¨°</text>\n        </view>\n      </view>\n\n      <scroll-view class=\"section-tabs\" scroll-x enable-flex>\n        <view v-for=\"tab in tabs\" :key=\"tab.value\" class=\"section-tab\" :class=\"{ active: activeTab === tab.value }\" @tap=\"activeTab = tab.value\">\n          {{ tab.label }}\n        </view>\n      </scroll-view>\n\n      <view class=\"tab-panel\" v-if=\"activeTab === 'purchase'\">\n        <view v-if=\"purchaseHistory.length\" class=\"record-list\">\n          <view class=\"record-card purchase-card\" v-for=\"item in purchaseHistory\" :key=\"item._id\">\n            <view class=\"purchase-head\">\n              <text class=\"purchase-title\">{{ item.package_name }}</text>\n              <text class=\"purchase-amount\">¬•{{ toAmount(item.amount) }}</text>\n            </view>\n            <view class=\"purchase-sub\">{{ item.purchase_date }} ¬∑ {{ item.service_times }} Ê¨°</view>\n            <view class=\"record-remark\" v-if=\"item.remark\">{{ item.remark }}</view>\n          </view>\n        </view>\n        <view v-else class=\"placeholder-list\"><text class=\"placeholder-title\">ÊöÇÊó†Ë¥≠‰π∞ËÆ∞ÂΩï</text></view>\n      </view>\n\n      <view class=\"tab-panel\" v-else-if=\"activeTab === 'consume'\">\n        <view class=\"placeholder-list\"><text class=\"placeholder-title\">ÊöÇÊó†Ê∂àËÄóËÆ∞ÂΩï</text></view>\n      </view>\n      <view class=\"tab-panel\" v-else-if=\"activeTab === 'booking'\">\n        <view class=\"placeholder-list\"><text class=\"placeholder-title\">ÊöÇÊó†È¢ÑÁ∫¶ËÆ∞ÂΩï</text></view>\n      </view>\n      <view class=\"tab-panel\" v-else-if=\"activeTab === 'gallery'\">\n        <view class=\"placeholder-list\"><text class=\"placeholder-line\">ÂõæÂ∫ìÂç†‰Ωç</text></view>\n      </view>\n      <view class=\"tab-panel\" v-else>\n        <text class=\"placeholder-title\">Â§áÊ≥®</text>\n        <textarea class=\"notes\" v-model=\"notesDraft\" placeholder=\"Â°´ÂÜôÂ§áÊ≥®\"></textarea>\n        <button class=\"btn primary\" @tap=\"saveNotes\">‰øùÂ≠òÂ§áÊ≥®</button>\n      </view>\n\n      <view class=\"cta-buttons\">\n        <button class=\"btn fab-btn\" @tap=\"goPurchase\">Ôºã Ë¥≠‰π∞</button>\n        <button class=\"btn fab-btn\" @tap=\"comingSoon('Ê∂àËÄó')\">Ôºã Ê∂àËÄó</button>\n        <button class=\"btn fab-btn gold\" @tap=\"comingSoon('È¢ÑÁ∫¶')\">Ôºã È¢ÑÁ∫¶</button>\n      </view>\n      <button class=\"btn danger ghost mt16\" @tap=\"confirmDelete\">Âà†Èô§ÂÆ¢Êà∑</button>\n    </scroll-view>\n  </view>\n</template>\n\n<script>\n// @ts-nocheck\nimport { getCustomerById, updateCustomer, deleteCustomer as deleteCustomerApi } from '@/api/customers.js'\nimport { listPurchases } from '@/api/purchases.js'\n\nexport default {\n  data() {\n    return {\n      id: '',\n      customer: {},\n      notesDraft: '',\n      defaultAvatar: 'https://cdn.uviewui.com/uview/album/1.jpg',\n      tabs: [\n        { label: 'Ë¥≠‰π∞', value: 'purchase' },\n        { label: 'Ê∂àËÄó', value: 'consume' },\n        { label: 'È¢ÑÁ∫¶', value: 'booking' },\n        { label: 'ÂõæÂ∫ì', value: 'gallery' },\n        { label: 'Â§áÊ≥®', value: 'notes' }\n      ],\n      activeTab: 'purchase',\n      purchaseHistory: []\n    }\n  },\n  onLoad(query) {\n    this.id = (query && query.id) || ''\n    if (!this.id) {\n      uni.showToast({ title: 'Áº∫Â∞ëÂÆ¢Êà∑ID', icon: 'none' })\n      setTimeout(() => uni.navigateBack(), 400)\n      return\n    }\n    this.loadData()\n  },\n  onShow() {\n    if (this.id) {\n      this.loadData()\n    }\n  },\n  methods: {\n    async loadData() {\n      try {\n        const data = await getCustomerById(this.id)\n        if (!data) {\n          uni.showToast({ title: 'ÂÆ¢Êà∑‰∏çÂ≠òÂú®', icon: 'none' })\n          setTimeout(() => uni.navigateBack(), 400)\n          return\n        }\n        this.customer = data\n        this.notesDraft = data.notes || ''\n        uni.setNavigationBarTitle({ title: data.name || 'ÂÆ¢Êà∑ËØ¶ÊÉÖ' })\n        this.loadPurchaseHistory()\n      } catch (err) {\n        uni.showToast({ title: err?.errMsg || err?.message || 'Âä†ËΩΩÂ§±Ë¥•', icon: 'none' })\n      }\n    },\n    async loadPurchaseHistory() {\n      try {\n        const list = await listPurchases(this.id)\n        this.purchaseHistory = list\n      } catch (err) {\n        console.log('load purchase failed', err)\n        this.purchaseHistory = []\n      }\n    },\n    goEdit() {\n      uni.navigateTo({ url: `/pages/my-customers/edit?id=${this.id}` })\n    },\n    goPurchase() {\n      uni.navigateTo({\n        url: '/pages/purchases/create',\n        events: {\n          purchaseCreated: () => {\n            this.loadPurchaseHistory()\n            uni.showToast({ title: 'Â∑≤ËÆ∞ÂΩïË¥≠‰π∞', icon: 'success' })\n          }\n        },\n        success: res => {\n          res.eventChannel.emit('initCustomerInfo', {\n            customerId: this.id,\n            customerName: this.customer.name\n          })\n        }\n      })\n    },\n    comingSoon(label) {\n      uni.showToast({ title: `${label}ÂäüËÉΩÂºÄÂèë‰∏≠`, icon: 'none' })\n    },\n    async saveNotes() {\n      try {\n        await updateCustomer({ _id: this.id, notes: this.notesDraft })\n        this.customer.notes = this.notesDraft\n        uni.showToast({ title: 'Â§áÊ≥®Â∑≤‰øùÂ≠ò', icon: 'success' })\n      } catch (err) {\n        uni.showToast({ title: err?.errMsg || err?.message || '‰øùÂ≠òÂ§±Ë¥•', icon: 'none' })\n      }\n    },\n    confirmDelete() {\n      uni.showModal({\n        title: 'Âà†Èô§ÂÆ¢Êà∑',\n        content: 'Âà†Èô§Âêé‰∏çÂèØÊÅ¢Â§çÔºåÁ°ÆÂÆöÂà†Èô§Ôºü',\n        confirmText: 'Âà†Èô§',\n        confirmColor: '#dd524d',\n        success: res => {\n          if (res.confirm) {\n            this.deleteCustomer()\n          }\n        }\n      })\n    },\n    async deleteCustomer() {\n      try {\n        await deleteCustomerApi(this.id)\n        uni.showToast({ title: 'Â∑≤Âà†Èô§', icon: 'success' })\n        setTimeout(() => uni.navigateBack(), 400)\n      } catch (err) {\n        uni.showToast({ title: err?.errMsg || err?.message || 'Âà†Èô§Â§±Ë¥•', icon: 'none' })\n      }\n    },\n    toAmount(n) {\n      try {\n        return Number(n || 0).toLocaleString('zh-CN')\n      } catch (e) {\n        return n\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.page { min-height:100vh; background:#f6f7f9; position:relative; }\n.content { height:100vh; padding:16px; box-sizing:border-box; }\n.hero { display:flex; gap:12px; align-items:center; background:#fff; border-radius:20px; padding:16px; box-shadow:0 10px 24px rgba(0,0,0,.04); }\n.hero .avatar { width:72px; height:72px; border-radius:36px; background:#eee; }\n.info { flex:1; }\n.name-row { display:flex; align-items:center; gap:8px; }\n.name { font-size:20px; font-weight:600; color:#222; }\n.vip-pill { font-size:12px; padding:2px 8px; border-radius:12px; background:#f3e7d3; color:#caa265; }\n.tag-row { margin-top:6px; display:flex; gap:8px; color:#9a9aa0; font-size:12px; }\n.tag-row .tag { background:#f6f6f8; padding:2px 8px; border-radius:10px; }\n.phone-row { margin-top:6px; font-size:14px; color:#555; display:flex; gap:6px; }\n.phone-icon { color:#b7b7bc; }\n\n.stat-card { margin-top:16px; background:#fff; border-radius:20px; padding:16px; display:flex; align-items:center; justify-content:space-between; }\n.stat { flex:1; text-align:center; }\n.stat-label { display:block; color:#9a9aa0; font-size:12px; margin-bottom:6px; }\n.stat-value { font-size:18px; font-weight:700; color:#333; }\n.divider { width:1px; height:36px; background:#f0f0f2; }\n\n.section-tabs { margin-top:18px; white-space:nowrap; }\n.section-tab { display:inline-flex; align-items:center; justify-content:center; height:34px; padding:0 14px; margin-right:10px; border-radius:17px; background:#fff; color:#666; font-size:13px; box-shadow:0 2px 6px rgba(0,0,0,0.04); }\n.section-tab.active { background:#caa265; color:#fff; font-weight:600; }\n\n.tab-panel { margin-top:14px; background:#fff; border-radius:20px; padding:16px; box-shadow:0 4px 12px rgba(0,0,0,0.03); }\n.record-list { display:flex; flex-direction:column; gap:10px; }\n.record-card { background:#fdfdfd; border-radius:16px; padding:12px; box-shadow:0 2px 6px rgba(0,0,0,0.03); }\n.purchase-card { padding:14px 16px; }\n.purchase-head { display:flex; justify-content:space-between; align-items:center; }\n.purchase-title { font-size:14px; color:#333; font-weight:600; }\n.purchase-amount { font-size:14px; color:#caa265; }\n.purchase-sub { margin-top:8px; font-size:12px; color:#9a9aa0; }\n.record-remark { margin-top:4px; font-size:12px; color:#9a9aa0; }\n.placeholder-title { font-size:14px; color:#333; font-weight:600; }\n.placeholder-line { display:block; margin-top:4px; color:#9a9aa0; font-size:12px; }\n.notes { width:100%; min-height:100px; margin:12px 0; background:#f6f7f9; border-radius:12px; padding:10px; box-sizing:border-box; }\n\n.btn { height:42px; border-radius:22px; font-size:15px; margin-top:8px; }\n.primary { background:#caa265; color:#fff; }\n.ghost { background:#fff; color:#caa265; border:1px solid #eedfc4; }\n.danger { color:#dd524d; border-color:#f6c8cd; }\n.mt16 { margin-top:16px; }\n.cta-buttons { margin:16px 0; display:flex; justify-content:space-between; gap:12px; }\n.fab-btn { flex:1; background:#fff; border-radius:24px; border:1px solid #eee; color:#333; height:42px; }\n.fab-btn.gold { background:#caa265; color:#fff; border:none; }\n\n.edit-btn { position:fixed; right:16px; top:12px; color:#caa265; padding:6px 12px; background:#fff; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.06); z-index:11; }\n</style>\r\n","import MiniProgramPage from 'D:/ÁßªÂä®‰∫ëÁõòÂêåÊ≠•Áõò/hua-Â∫îÁî®/be-crm/be-crm/be-crm/pages/my-customers/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","query","uni","data","getCustomerById","err","list","listPurchases","res","label","updateCustomer","deleteCustomerApi","n","MiniProgramPage"],"mappings":"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"}