{"version":3,"file":"customersStore.js","sources":["utils/customersStore.js"],"sourcesContent":["// utils/customersStore.js\n\nconst KEY = 'customers_mock';\n\n/** 读取客户列表（本地存储） */\nexport function loadCustomers(fallback = []) {\n  try {\n    const val = uni.getStorageSync(KEY);\n    return Array.isArray(val) ? val : fallback;\n  } catch (e) {\n    return fallback;\n  }\n}\n\n/** 写入客户列表（本地存储） */\nexport function saveCustomers(list) {\n  uni.setStorageSync(KEY, list || []);\n}\n\n/** 生成简单唯一ID */\nexport function genId() {\n  return String(Date.now()) + Math.random().toString(16).slice(2, 8);\n}\n\n/** 按 id 查找 */\nexport function findById(list, id) {\n  return (list || []).find(i => i && i._id === id);\n}\n\n/** 按手机号查找（可选） */\nexport function findByPhone(list, phone) {\n  const p = (phone || '').trim();\n  if (!p) return null;\n  return (list || []).find(i => (i.phone || '').trim() === p);\n}\n\n/** 新增或替换 */\nexport function upsert(list, item) {\n  const arr = list || [];\n  const idx = arr.findIndex(x => x && x._id === item._id);\n  if (idx >= 0) {\n    arr.splice(idx, 1, item);\n  } else {\n    arr.unshift(item);\n  }\n  return arr;\n}\n\n/** 按 id 删除 */\nexport function removeById(list, id) {\n  const arr = list || [];\n  const idx = arr.findIndex(x => x && x._id === id);\n  if (idx >= 0) arr.splice(idx, 1);\n  return arr;\n}\n\n/** 按门店筛选：''=全部；'_unassigned'=未分配；其它=具体 store_id */\nexport function filterByStoreId(list, storeId) {\n  const arr = list || [];\n  if (!storeId) return arr;\n  if (storeId === '_unassigned') return arr.filter(x => !x.store_id);\n  return arr.filter(x => x.store_id === storeId);\n}\n\n/** 一次性迁移：给旧客户补上 store_id 字段（默认空字符串） */\nexport function migrateCustomersStoreId() {\n  const arr = loadCustomers([]);\n  let changed = false;\n  arr.forEach(c => {\n    if (c && !('store_id' in c)) { c.store_id = ''; changed = true; }\n  });\n  if (changed) saveCustomers(arr);\n}\n\n/** 可选：提供演示数据 */\nexport function demoCustomers() {\n  return [\n    // 示例：请按需补充 store_id（否则会被迁移脚本置空）\n    // { _id: genId(), name: '张小姐', phone: '13888888888', is_vip: true, store_id: '', total_spend: 28500, visit_count: 32, city: '上海市静安区', tag: '面部护理' }\n  ];\n}\n\n/** 方便默认导入（可选） */\nexport default {\n  loadCustomers,\n  saveCustomers,\n  genId,\n  findById,\n  findByPhone,\n  upsert,\n  removeById,\n  filterByStoreId,\n  migrateCustomersStoreId,\n  demoCustomers\n};\n"],"names":[],"mappings":";;AAyDO,SAAS,gBAAgB,MAAM,SAAS;AAC7C,QAAM,MAAM,QAAQ;AACpB,MAAI,CAAC;AAAS,WAAO;AACrB,MAAI,YAAY;AAAe,WAAO,IAAI,OAAO,OAAK,CAAC,EAAE,QAAQ;AACjE,SAAO,IAAI,OAAO,OAAK,EAAE,aAAa,OAAO;AAC/C;;"}