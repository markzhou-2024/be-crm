{"version":3,"file":"createAnimation.js","sources":["uni_modules/uni-transition/components/uni-transition/createAnimation.js"],"sourcesContent":["// const defaultOption = {\r\n// \tduration: 300,\r\n// \ttimingFunction: 'linear',\r\n// \tdelay: 0,\r\n// \ttransformOrigin: '50% 50% 0'\r\n// }\r\n// #ifdef APP-NVUE\r\nconst nvueAnimation = uni.requireNativePlugin('animation')\r\n// #endif\r\nclass MPAnimation {\r\n\tconstructor(options, _this) {\r\n\t\tthis.options = options\r\n\t\tthis.animation = uni.createAnimation(options)\r\n\t\tthis.currentStepAnimates = {}\r\n\t\tthis.next = 0\r\n\t\tthis.$ = _this\r\n\r\n\t}\r\n\r\n\t_nvuePushAnimates(type, args) {\r\n\t\tlet aniObj = this.currentStepAnimates[this.next]\r\n\t\tlet styles = {}\r\n\t\tif (!aniObj) {\r\n\t\t\tstyles = {\r\n\t\t\t\tstyles: {},\r\n\t\t\t\tconfig: {}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tstyles = aniObj\r\n\t\t}\r\n\t\tif (animateTypes1.includes(type)) {\r\n\t\t\tif (!styles.styles.transform) {\r\n\t\t\t\tstyles.styles.transform = ''\r\n\t\t\t}\n\t\t\tlet unit = ''\n\t\t\tif(type === 'rotate'){\n\t\t\t\tunit = 'deg'\n\t\t\t}\r\n\t\t\tstyles.styles.transform += `${type}(${args+unit}) `\r\n\t\t} else {\r\n\t\t\tstyles.styles[type] = `${args}`\r\n\t\t}\r\n\t\tthis.currentStepAnimates[this.next] = styles\r\n\t}\r\n\t_animateRun(styles = {}, config = {}) {\r\n\t\tlet ref = this.$.$refs['ani'].ref\r\n\t\tif (!ref) return\r\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tnvueAnimation.transition(ref, {\r\n\t\t\t\tstyles,\r\n\t\t\t\t...config\r\n\t\t\t}, res => {\r\n\t\t\t\tresolve()\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t_nvueNextAnimate(animates, step = 0, fn) {\r\n\t\tlet obj = animates[step]\r\n\t\tif (obj) {\r\n\t\t\tlet {\r\n\t\t\t\tstyles,\r\n\t\t\t\tconfig\r\n\t\t\t} = obj\r\n\t\t\tthis._animateRun(styles, config).then(() => {\r\n\t\t\t\tstep += 1\r\n\t\t\t\tthis._nvueNextAnimate(animates, step, fn)\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tthis.currentStepAnimates = {}\r\n\t\t\ttypeof fn === 'function' && fn()\r\n\t\t\tthis.isEnd = true\r\n\t\t}\r\n\t}\r\n\r\n\tstep(config = {}) {\n\t\t// #ifndef APP-NVUE\n\t\tthis.animation.step(config)\r\n\t\t// #endif\r\n\t\t// #ifdef APP-NVUE\r\n\t\tthis.currentStepAnimates[this.next].config = Object.assign({}, this.options, config)\n\t\tthis.currentStepAnimates[this.next].styles.transformOrigin = this.currentStepAnimates[this.next].config.transformOrigin\n\t\tthis.next++\r\n\t\t// #endif\r\n\t\treturn this\r\n\t}\r\n\r\n\trun(fn) {\r\n\t\t// #ifndef APP-NVUE\n\t\tthis.$.animationData = this.animation.export()\r\n\t\tthis.$.timer = setTimeout(() => {\n\t\t\ttypeof fn === 'function' && fn()\r\n\t\t}, this.$.durationTime)\r\n\t\t// #endif\r\n\t\t// #ifdef APP-NVUE\r\n\t\tthis.isEnd = false\n\t\tlet ref = this.$.$refs['ani'] && this.$.$refs['ani'].ref\n\t\tif(!ref) return\r\n\t\tthis._nvueNextAnimate(this.currentStepAnimates, 0, fn)\r\n\t\tthis.next = 0\r\n\t\t// #endif\r\n\t}\r\n}\r\n\r\n\r\nconst animateTypes1 = ['matrix', 'matrix3d', 'rotate', 'rotate3d', 'rotateX', 'rotateY', 'rotateZ', 'scale', 'scale3d',\r\n\t'scaleX', 'scaleY', 'scaleZ', 'skew', 'skewX', 'skewY', 'translate', 'translate3d', 'translateX', 'translateY',\r\n\t'translateZ'\r\n]\r\nconst animateTypes2 = ['opacity', 'backgroundColor']\r\nconst animateTypes3 = ['width', 'height', 'left', 'right', 'top', 'bottom']\r\nanimateTypes1.concat(animateTypes2, animateTypes3).forEach(type => {\r\n\tMPAnimation.prototype[type] = function(...args) {\r\n\t\t// #ifndef APP-NVUE\n\t\tthis.animation[type](...args)\n\t\t// #endif\r\n\t\t// #ifdef APP-NVUE\r\n\t\tthis._nvuePushAnimates(type, args)\r\n\t\t// #endif\r\n\t\treturn this\r\n\t}\r\n})\r\n\r\nexport function createAnimation(option, _this) {\n\tif(!_this) return\r\n\tclearTimeout(_this.timer)\r\n\treturn new MPAnimation(option, _this)\r\n}\n"],"names":["MPAnimation","options","_this","uni","type","args","aniObj","styles","animateTypes1","unit","config","ref","resolve","reject","res","animates","step","fn","obj","animateTypes2","animateTypes3","createAnimation","option"],"mappings":"6DASA,MAAMA,CAAY,CACjB,YAAYC,EAASC,EAAO,CAC3B,KAAK,QAAUD,EACf,KAAK,UAAYE,QAAI,gBAAgBF,CAAO,EAC5C,KAAK,oBAAsB,CAAE,EAC7B,KAAK,KAAO,EACZ,KAAK,EAAIC,CAET,CAED,kBAAkBE,EAAMC,EAAM,CAC7B,IAAIC,EAAS,KAAK,oBAAoB,KAAK,IAAI,EAC3CC,EAAS,CAAE,EASf,GARKD,EAMJC,EAASD,EALTC,EAAS,CACR,OAAQ,CAAE,EACV,OAAQ,CAAE,CACV,EAIEC,EAAc,SAASJ,CAAI,EAAG,CAC5BG,EAAO,OAAO,YAClBA,EAAO,OAAO,UAAY,IAE3B,IAAIE,EAAO,GACRL,IAAS,WACXK,EAAO,OAERF,EAAO,OAAO,WAAa,GAAGH,CAAI,IAAIC,EAAKI,CAAI,IAClD,MACGF,EAAO,OAAOH,CAAI,EAAI,GAAGC,CAAI,GAE9B,KAAK,oBAAoB,KAAK,IAAI,EAAIE,CACtC,CACD,YAAYA,EAAS,GAAIG,EAAS,CAAA,EAAI,CACrC,IAAIC,EAAM,KAAK,EAAE,MAAM,IAAO,IAC9B,GAAKA,EACL,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACvC,cAAc,WAAWF,EAAK,CAC7B,OAAAJ,EACA,GAAGG,CACH,EAAEI,GAAO,CACTF,EAAS,CACb,CAAI,CACJ,CAAG,CACD,CAED,iBAAiBG,EAAUC,EAAO,EAAGC,EAAI,CACxC,IAAIC,EAAMH,EAASC,CAAI,EACvB,GAAIE,EAAK,CACR,GAAI,CACH,OAAAX,EACA,OAAAG,CACJ,EAAOQ,EACJ,KAAK,YAAYX,EAAQG,CAAM,EAAE,KAAK,IAAM,CAC3CM,GAAQ,EACR,KAAK,iBAAiBD,EAAUC,EAAMC,CAAE,CAC5C,CAAI,CACJ,MACG,KAAK,oBAAsB,CAAE,EAC7B,OAAOA,GAAO,YAAcA,EAAI,EAChC,KAAK,MAAQ,EAEd,CAED,KAAKP,EAAS,GAAI,CAEjB,YAAK,UAAU,KAAKA,CAAM,EAOnB,IACP,CAED,IAAIO,EAAI,CAEP,KAAK,EAAE,cAAgB,KAAK,UAAU,OAAQ,EAC9C,KAAK,EAAE,MAAQ,WAAW,IAAM,CAC/B,OAAOA,GAAO,YAAcA,EAAI,CACnC,EAAK,KAAK,EAAE,YAAY,CAStB,CACF,CAGA,MAAMT,EAAgB,CAAC,SAAU,WAAY,SAAU,WAAY,UAAW,UAAW,UAAW,QAAS,UAC5G,SAAU,SAAU,SAAU,OAAQ,QAAS,QAAS,YAAa,cAAe,aAAc,aAClG,YACD,EACMW,EAAgB,CAAC,UAAW,iBAAiB,EAC7CC,EAAgB,CAAC,QAAS,SAAU,OAAQ,QAAS,MAAO,QAAQ,EAC1EZ,EAAc,OAAOW,EAAeC,CAAa,EAAE,QAAQhB,GAAQ,CAClEJ,EAAY,UAAUI,CAAI,EAAI,YAAYC,EAAM,CAE/C,YAAK,UAAUD,CAAI,EAAE,GAAGC,CAAI,EAKrB,IACP,CACF,CAAC,EAEM,SAASgB,EAAgBC,EAAQpB,EAAO,CAC9C,GAAIA,EACJ,oBAAaA,EAAM,KAAK,EACjB,IAAIF,EAAYsB,EAAQpB,CAAK,CACrC"}