{"version":3,"file":"uni-id-pages-fab-login.js","sources":["uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue","/Users/zhouzhongwei/Documents/HBuilderProjects/be-crm-main/uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue?type=component"],"sourcesContent":["<template>\n\t<view>\n\t\t<view class=\"fab-login-box\">\n\t\t\t<view class=\"item\" v-for=\"(item,index) in servicesList\" :key=\"index\"\n\t\t\t\t@click=\"item.path?toPage(item.path):login_before(item.id,false)\">\n\t\t\t\t<image class=\"logo\" :src=\"item.logo\" mode=\"scaleToFill\"></image>\n\t\t\t\t<text class=\"login-title\">{{item.text}}</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n<script>\n\timport config from '@/uni_modules/uni-id-pages/config.js'\n\t//前一个窗口的页面地址。控制点击切换快捷登录方式是创建还是返回\n\timport {store,mutations} from '@/uni_modules/uni-id-pages/common/store.js'\n\tlet allServicesList = []\n\texport default {\n\t\tcomputed: {\n\t\t\tagreements() {\n\t\t\t\tif (!config.agreements) {\n\t\t\t\t\treturn []\n\t\t\t\t}\n\t\t\t\tlet {\n\t\t\t\t\tserviceUrl,\n\t\t\t\t\tprivacyUrl\n\t\t\t\t} = config.agreements\n\t\t\t\treturn [{\n\t\t\t\t\t\turl: serviceUrl,\n\t\t\t\t\t\ttitle: \"用户服务协议\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\turl: privacyUrl,\n\t\t\t\t\t\ttitle: \"隐私政策条款\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\tagree: {\n\t\t\t\tget() {\n\t\t\t\t\treturn this.getParentComponent().agree\n\t\t\t\t},\n\t\t\t\tset(agree) {\n\t\t\t\t\treturn this.getParentComponent().agree = agree\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tservicesList: [{\n\t\t\t\t\t\t\"id\": \"username\",\n\t\t\t\t\t\t\"text\": \"账号登录\",\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/login/uni-fab-login/user.png\",\n\t\t\t\t\t\t\"path\": \"/uni_modules/uni-id-pages/pages/login/login-withpwd\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"smsCode\",\n\t\t\t\t\t\t\"text\": \"短信验证码\",\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/login/uni-fab-login/sms.png\",\n\t\t\t\t\t\t\"path\": \"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=smsCode\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"weixin\",\n\t\t\t\t\t\t\"text\": \"微信登录\",\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/login/uni-fab-login/weixin.png\",\n\t\t\t\t\t},\n\t\t\t\t\t// #ifndef MP-WEIXIN\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"apple\",\n\t\t\t\t\t\t\"text\": \"苹果登录\",\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/app-plus/uni-fab-login/apple.png\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"univerify\",\n\t\t\t\t\t\t\"text\": \"一键登录\",\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/app-plus/uni-fab-login/univerify.png\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"taobao\",\n\t\t\t\t\t\t\"text\": \"淘宝登录\", //暂未提供该登录方式的接口示例\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/app-plus/uni-fab-login/taobao.png\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"facebook\",\n\t\t\t\t\t\t\"text\": \"脸书登录\", //暂未提供该登录方式的接口示例\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/app-plus/uni-fab-login/facebook.png\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"alipay\",\n\t\t\t\t\t\t\"text\": \"支付宝登录\", //暂未提供该登录方式的接口示例\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/app-plus/uni-fab-login/alipay.png\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"qq\",\n\t\t\t\t\t\t\"text\": \"QQ登录\", //暂未提供该登录方式的接口示例\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/app-plus/uni-fab-login/qq.png\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"google\",\n\t\t\t\t\t\t\"text\": \"谷歌登录\", //暂未提供该登录方式的接口示例\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/app-plus/uni-fab-login/google.png\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"douyin\",\n\t\t\t\t\t\t\"text\": \"抖音登录\", //暂未提供该登录方式的接口示例\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/app-plus/uni-fab-login/douyin.png\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"id\": \"sinaweibo\",\n\t\t\t\t\t\t\"text\": \"新浪微博\", //暂未提供该登录方式的接口示例\n\t\t\t\t\t\t\"logo\": \"/uni_modules/uni-id-pages/static/app-plus/uni-fab-login/sinaweibo.png\",\n\t\t\t\t\t}\n\t\t\t\t\t// #endif\n\t\t\t\t],\n\t\t\t\tuniverifyStyle: { //一键登录弹出窗的样式配置参数\n\t\t\t\t\t\"fullScreen\": true, // 是否全屏显示，true表示全屏模式，false表示非全屏模式，默认值为false。\n\t\t\t\t\t\"backgroundColor\": \"#ffffff\", // 授权页面背景颜色，默认值：#ffffff\n\t\t\t\t\t\"buttons\": { // 自定义登录按钮\n\t\t\t\t\t\t\"iconWidth\": \"45px\", // 图标宽度（高度等比例缩放） 默认值：45px\n\t\t\t\t\t\t\"list\": []\n\t\t\t\t\t},\n\t\t\t\t\t\"privacyTerms\": {\n\t\t\t\t\t\t\"defaultCheckBoxState\": false, // 条款勾选框初始状态 默认值： true\n\t\t\t\t\t\t\"textColor\": \"#BBBBBB\", // 文字颜色 默认值：#BBBBBB\n\t\t\t\t\t\t\"termsColor\": \"#5496E3\", //  协议文字颜色 默认值： #5496E3\n\t\t\t\t\t\t\"prefix\": \"我已阅读并同意\", // 条款前的文案 默认值：“我已阅读并同意”\n\t\t\t\t\t\t\"suffix\": \"并使用本机号码登录\", // 条款后的文案 默认值：“并使用本机号码登录”\n\t\t\t\t\t\t\"privacyItems\": []\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\twatch: {\n\t\t\tagree(agree) {\n\t\t\t\tthis.univerifyStyle.privacyTerms.defaultCheckBoxState = agree\n\t\t\t}\n\t\t},\n\t\tasync created() {\n\t\t\tlet servicesList = this.servicesList\n\t\t\tlet loginTypes = config.loginTypes\n\n\t\t\tservicesList = servicesList.filter(item => {\n\n\t\t\t\t// #ifndef APP\n\t\t\t\t//非app端去掉apple登录\n\t\t\t\tif (item.id == 'apple') {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\t// #endif\n\n\t\t\t\t// #ifdef APP\n\t\t\t\t//去掉非ios系统上的apple登录\n\t\t\t\tif (item.id == 'apple' && uni.getSystemInfoSync().osName != 'ios') {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\t// #endif\n\n\t\t\t\treturn loginTypes.includes(item.id)\n\t\t\t})\n\t\t\t//处理一键登录\n\t\t\tif (loginTypes.includes('univerify')) {\n\t\t\t\tthis.univerifyStyle.privacyTerms.privacyItems = this.agreements\n\t\t\t\t//设置一键登录功能底下的快捷登录按钮\n\t\t\t\tservicesList.forEach(({\n\t\t\t\t\tid,\n\t\t\t\t\tlogo,\n\t\t\t\t\tpath\n\t\t\t\t}) => {\n\t\t\t\t\tif (id != 'univerify') {\n\t\t\t\t\t\tthis.univerifyStyle.buttons.list.push({\n\t\t\t\t\t\t\t\"iconPath\": logo,\n\t\t\t\t\t\t\t\"provider\": id,\n\t\t\t\t\t\t\tpath //路径用于点击快捷按钮时判断是跳转页面\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\t//\tconsole.log(servicesList);\n\n\t\t\t//去掉当前页面对应的登录选项\n\t\t\tthis.servicesList = servicesList.filter(item => {\n\t\t\t\tlet path = item.path ? item.path.split('?')[0] : '';\n\t\t\t\treturn path != this.getRoute(1)\n\t\t\t})\n\t\t},\n\t\tmethods: {\n\t\t\tgetParentComponent(){\n\t\t\t\t// #ifndef H5\n\t\t\t\treturn this.$parent;\n\t\t\t\t// #endif\n\n\t\t\t\t// #ifdef H5\n\t\t\t\treturn this.$parent.$parent;\n\t\t\t\t// #endif\n\t\t\t},\n\t\t\tsetUserInfo(e) {\n\t\t\t\tconsole.log('setUserInfo', e);\n\t\t\t},\n\t\t\tgetRoute(n = 0) {\n\t\t\t\tlet pages = getCurrentPages();\n\t\t\t\tif (n > pages.length) {\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\t\t\t\treturn '/' + pages[pages.length - n].route\n\t\t\t},\n\t\t\ttoPage(path,index = 0) {\n\t\t\t\t//console.log('比较', this.getRoute(1),this.getRoute(2), path)\n\t\t\t\tif (this.getRoute(1) == path.split('?')[0] && this.getRoute(1) ==\n\t\t\t\t\t'/uni_modules/uni-id-pages/pages/login/login-withoutpwd') {\n\t\t\t\t\t//如果要被打开的页面已经打开，且这个页面是 /uni_modules/uni-id-pages/pages/index/index 则把类型参数传给他\n\t\t\t\t\tlet loginType = path.split('?')[1].split('=')[1]\n\t\t\t\t\tuni.$emit('uni-id-pages-setLoginType', loginType)\n\t\t\t\t} else if (this.getRoute(2) == path) { // 如果上一个页面就是，马上要打开的页面，直接返回。防止重复开启\n\t\t\t\t\tuni.navigateBack();\n\t\t\t\t} else if (this.getRoute(1) != path) {\n\t\t\t\t\tif(index === 0){\n\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\turl: path,\n\t\t\t\t\t\t\tanimationType: 'slide-in-left',\n\t\t\t\t\t\t\tcomplete(e) {\n\t\t\t\t\t\t\t\t// console.log(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}else{\n\t\t\t\t\t\tuni.redirectTo({\n\t\t\t\t\t\t\turl: path,\n\t\t\t\t\t\t\tanimationType: 'slide-in-left',\n\t\t\t\t\t\t\tcomplete(e) {\n\t\t\t\t\t\t\t\t// console.log(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('出乎意料的情况,path：' + path);\n\t\t\t\t}\n\t\t\t},\n\t\t\tasync login_before(type, navigateBack = true, options = {}) {\n\t\t\t\tconsole.log(type);\n\t\t\t\t//提示空实现\n\t\t\t\tif ([\"qq\",\n\t\t\t\t\t\t\"xiaomi\",\n\t\t\t\t\t\t\"sinaweibo\",\n\t\t\t\t\t\t\"taobao\",\n\t\t\t\t\t\t\"facebook\",\n\t\t\t\t\t\t\"google\",\n\t\t\t\t\t\t\"alipay\",\n\t\t\t\t\t\t\"douyin\",\n\t\t\t\t\t].includes(type)) {\n\t\t\t\t\treturn uni.showToast({\n\t\t\t\t\t\ttitle: '该登录方式暂未实现，欢迎提交pr',\n\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\tduration: 3000\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t//检查当前环境是否支持这种登录方式\n\t\t\t\t// #ifdef APP\n\t\t\t\tlet isAppExist = true\n\t\t\t\tawait new Promise((callback) => {\n\t\t\t\t\tplus.oauth.getServices(oauthServices => {\n\t\t\t\t\t\tlet index = oauthServices.findIndex(e => e.id == type)\n\t\t\t\t\t\tif(index != -1){\n\t\t\t\t\t\t\tisAppExist = oauthServices[index].nativeClient\n\t\t\t\t\t\t\tcallback()\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\treturn uni.showToast({\n\t\t\t\t\t\t\t\ttitle: '当前设备不支持此登录，请选择其他登录方式',\n\t\t\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\t\t\tduration: 3000\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, err => {\n\t\t\t\t\t\tthrow new Error('获取服务供应商失败：' + JSON.stringify(err))\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t// #endif\n\n\t\t\t\tif (\n\t\t\t\t\t// #ifdef APP\n\t\t\t\t\t!isAppExist\n\t\t\t\t\t// #endif\n\n\t\t\t\t\t//非app端使用了，app特有登录方式\n\t\t\t\t\t// #ifndef APP\n\t\t\t\t\t[\"univerify\",\"apple\"].includes(type)\n\t\t\t\t\t// #endif\n\n\t\t\t\t) {\n\t\t\t\t\treturn uni.showToast({\n\t\t\t\t\t\ttitle: '当前设备不支持此登录，请选择其他登录方式',\n\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\tduration: 3000\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t//判断是否需要弹出隐私协议授权框\n\t\t\t\tlet needAgreements = (config?.agreements?.scope || []).includes('register')\n\t\t\t\tif (type != 'univerify' && needAgreements && !this.agree) {\n\t\t\t\t\tlet agreementsRef = this.getParentComponent().$refs.agreements\n\t\t\t\t\treturn agreementsRef.popup(() => {\n\t\t\t\t\t\tthis.login_before(type, navigateBack, options)\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t// #ifdef H5\n\t\t\t\tif(type == 'weixin'){\n\t\t\t\t\t\t// console.log('开始微信网页登录');\n\t\t\t\t\t\t// let redirectUrl = location.protocol +'//'+\n\t\t\t\t\t\t// \t\t\t\tdocument.domain +\n\t\t\t\t\t\t// \t\t\t\t(window.location.href.includes('#')?'/#':'') +\n\t\t\t\t\t\t// \t\t\t\t'/uni_modules/uni-id-pages/pages/login/login-withoutpwd?is_weixin_redirect=true&type=weixin'\n\t\t\t\t\t// #ifdef VUE2\n\t\t\t\t\tconst baseUrl = process.env.BASE_URL\n\t\t\t\t\t// #endif\n\t\t\t\t\t// #ifdef VUE3\n\t\t\t\t\tconst baseUrl = import.meta.env.BASE_URL\n\t\t\t\t\t// #endif\n\n\t\t\t\t\tlet redirectUrl = location.protocol +\n\t\t\t\t\t\t'//' +\n\t\t\t\t\t\tlocation.host +\n\t\t\t\t\t\tbaseUrl.replace(/\\/$/, '') +\n\t\t\t\t\t\t(window.location.href.includes('#')?'/#':'') +\n\t\t\t\t\t\t'/uni_modules/uni-id-pages/pages/login/login-withoutpwd?is_weixin_redirect=true&type=weixin'\n\t\t\t\t\t\t\n\t\t\t\t\tredirectUrl=redirectUrl.replace(location.host,config.webWXAuthBackDomain)\n\n\t\t\t\t\t// console.log('redirectUrl----',redirectUrl);\n\t\t\t\t\tlet ua = window.navigator.userAgent.toLowerCase();\n\t\t\t\t\tif (ua.match(/MicroMessenger/i) == 'micromessenger'){\n\t\t\t\t\t\t// console.log('在微信公众号内');\n\t\t\t\t\t\treturn window.open(`https://open.weixin.qq.com/connect/oauth2/authorize?\n\t\t\t\t\t\t\t\t\tappid=${config.appid.weixin.h5}\n\t\t\t\t\t\t\t\t\t&redirect_uri=${encodeURIComponent(redirectUrl)}\n\t\t\t\t\t\t\t\t\t&response_type=code\n\t\t\t\t\t\t\t\t\t&scope=snsapi_userinfo\n\t\t\t\t\t\t\t\t\t&state=STATE&connect_redirect=1#wechat_redirect`);\n\n\t\t\t\t\t}else{\n\t\t\t\t\t\t// console.log('非微信公众号内');\n\t\t\t\t\t\treturn location.href = `https://open.weixin.qq.com/connect/qrconnect?appid=${config.appid.weixin.web}\n\t\t\t\t\t\t\t\t\t\t&redirect_uri=${encodeURIComponent(redirectUrl)}\n\t\t\t\t\t\t\t\t\t\t&response_type=code&scope=snsapi_login&state=STATE#wechat_redirect`\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// #endif\n\n\t\t\t\tuni.showLoading({\n\t\t\t\t\tmask: true\n\t\t\t\t})\n\n\t\t\t\tif (type == 'univerify') {\n\t\t\t\t\tlet univerifyManager = uni.getUniverifyManager()\n\t\t\t\t\tlet clickAnotherButtons = false\n\t\t\t\t\tlet onButtonsClickFn = async res => {\n\t\t\t\t\t\tconsole.log('点击了第三方登录，provider：', res, res.provider, this.univerifyStyle.buttons.list);\n\t\t\t\t\t\tclickAnotherButtons = true\n\t\t\t\t\t\tlet checkBoxState = await uni.getCheckBoxState();\n\t\t\t\t\t\t// 同步一键登录弹出层隐私协议框是否打勾\n\t\t\t\t\t\t// #ifdef VUE2\n\t\t\t\t\t\tthis.agree = checkBoxState[1].state\n\t\t\t\t\t\t// #endif\n\t\t\t\t\t\t// #ifdef VUE3\n\t\t\t\t\t\tthis.agree = checkBoxState.state\n\t\t\t\t\t\t// #endif\n\t\t\t\t\t\tlet {\n\t\t\t\t\t\t\tpath\n\t\t\t\t\t\t} = this.univerifyStyle.buttons.list[res.index]\n\t\t\t\t\t\tif (path) {\n\t\t\t\t\t\t\tif( this.getRoute(1).includes('login-withoutpwd') && path.includes('login-withoutpwd') ){\n\t\t\t\t\t\t\t\tthis.getParentComponent().showCurrentWebview()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.toPage(path,1)\n\t\t\t\t\t\t\tcloseUniverify()\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (this.agree) {\n\t\t\t\t\t\t\t\tcloseUniverify()\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tthis.login_before(res.provider)\n\t\t\t\t\t\t\t\t}, 500)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ttitle: \"你未同意隐私政策协议\",\n\t\t\t\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\t\t\t\tduration: 3000\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction closeUniverify() {\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\tuniverifyManager.close()\n\t\t\t\t\t\t// 取消订阅自定义按钮点击事件\n\t\t\t\t\t\tuniverifyManager.offButtonsClick(onButtonsClickFn)\n\t\t\t\t\t}\n\t\t\t\t\t// 订阅自定义按钮点击事件\n\t\t\t\t\tuniverifyManager.onButtonsClick(onButtonsClickFn)\n\t\t\t\t\t// 调用一键登录弹框\n\t\t\t\t\treturn univerifyManager.login({\n\t\t\t\t\t\t\"univerifyStyle\": this.univerifyStyle,\n\t\t\t\t\t\tsuccess: res => {\n\t\t\t\t\t\t\tthis.login(res.authResult, 'univerify')\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail(err) {\n\t\t\t\t\t\t\tconsole.log(err)\n\t\t\t\t\t\t\tif(!clickAnotherButtons){\n\t\t\t\t\t\t\t\tuni.navigateBack()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// uni.showToast({\n\t\t\t\t\t\t\t// \ttitle: JSON.stringify(err),\n\t\t\t\t\t\t\t// \ticon: 'none',\n\t\t\t\t\t\t\t// \tduration: 3000\n\t\t\t\t\t\t\t// });\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete: async e => {\n\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t\t//同步一键登录弹出层隐私协议框是否打勾\n\t\t\t\t\t\t\t// this.agree = (await uni.getCheckBoxState())[1].state\n\t\t\t\t\t\t\t// 取消订阅自定义按钮点击事件\n\t\t\t\t\t\t\tuniverifyManager.offButtonsClick(onButtonsClickFn)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tif (type === 'weixinMobile') {\n\t\t\t\t\treturn this.login({\n\t\t\t\t\t\tphoneCode: options.phoneNumberCode\n\t\t\t\t\t}, type)\n\t\t\t\t}\n\n\t\t\t\tuni.login({\n\t\t\t\t\t\"provider\": type,\n\t\t\t\t\t\"onlyAuthorize\": true,\n\t\t\t\t\t// #ifdef APP\n\t\t\t\t\t\"univerifyStyle\": this.univerifyStyle,\n\t\t\t\t\t// #endif\n\t\t\t\t\tsuccess: async e => {\n\t\t\t\t\t\tif (type == 'apple') {\n\t\t\t\t\t\t\tlet res = await this.getUserInfo({\n\t\t\t\t\t\t\t\tprovider: \"apple\"\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tObject.assign(e.authResult, res.userInfo)\n\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.login(type == 'weixin' ? {\n\t\t\t\t\t\t\tcode: e.code\n\t\t\t\t\t\t} : e.authResult, type)\n\t\t\t\t\t},\n\t\t\t\t\tfail: async (err) => {\n\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\tlogin(params, type) { //联网验证登录\n\t\t\t\t// console.log('执行登录开始----');\n\t\t\t\tconsole.log({params,type});\n\t\t\t\t//toLowerCase\n\t\t\t\tlet action = 'loginBy' + type.trim().replace(type[0], type[0].toUpperCase())\n\t\t\t\tconst uniIdCo = uniCloud.importObject(\"uni-id-co\",{\n\t\t\t\t\tcustomUI:true\n\t\t\t\t})\n\t\t\t\tuniIdCo[action](params).then(result => {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '登录成功',\n\t\t\t\t\t\ticon: 'none',\n\t\t\t\t\t\tduration: 2000\n\t\t\t\t\t});\n\t\t\t\t\t// #ifdef H5\n\t\t\t\t\tresult.loginType = type\n\t\t\t\t\t// #endif\n\t\t\t\t\tmutations.loginSuccess(result)\n\t\t\t\t})\n\t\t\t\t.catch(e=>{\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\tcontent: e.message,\n\t\t\t\t\t\tconfirmText:\"知道了\",\n\t\t\t\t\t\tshowCancel: false\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.finally(e => {\n\t\t\t\t\tif (type == 'univerify') {\n\t\t\t\t\t\tuni.closeAuthView()\n\t\t\t\t\t}\n\t\t\t\t\tuni.hideLoading()\n\t\t\t\t})\n\t\t\t},\n\t\t\tasync getUserInfo(e) {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tuni.getUserInfo({\n\t\t\t\t\t\t...e,\n\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\tresolve(res);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\t\t\tcontent: JSON.stringify(err),\n\t\t\t\t\t\t\t\tshowCancel: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t/* #ifndef APP-NVUE */\n\t.fab-login-box,\n\t.item {\n\t\tdisplay: flex;\n\t\tbox-sizing: border-box;\n\t\tflex-direction: column;\n\t}\n\t/* #endif */\n\n\t.fab-login-box {\n\t\tflex-direction: row;\n\t\tflex-wrap: wrap;\n\t\twidth: 750rpx;\n\t\tjustify-content: space-around;\n\t\tposition: fixed;\n\t\tleft: 0;\n\t}\n\n\t.item {\n\t\tflex-direction: column;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\theight: 200rpx;\n\t\tcursor: pointer;\n\t}\n\n\t/* #ifndef APP-NVUE */\n\t@media screen and (min-width: 690px) {\n\t\t.fab-login-box {\n\t\t\tmax-width: 500px;\n\t\t\tmargin-left: calc(50% - 250px);\n\t\t}\n\t\t.item {\n\t\t\theight: 160rpx;\n\t\t}\n\t}\n\n\t@media screen and (max-width: 690px) {\n\t\t.fab-login-box {\n\t\t\tbottom: 10rpx;\n\t\t}\n\t}\n\n\t/* #endif */\n\n\t.logo {\n\t\twidth: 60rpx;\n\t\theight: 60rpx;\n\t\tmax-width: 40px;\n\t\tmax-height: 40px;\n\t\tborder-radius: 100%;\n\t\tborder: solid 1px #F6F6F6;\n\t}\n\n\t.login-title {\n\t\ttext-align: center;\n\t\tmargin-top: 6px;\n\t\tcolor: #999;\n\t\tfont-size: 10px;\n\t\twidth: 70px;\n\t}\n</style>\n","import Component from '/Users/zhouzhongwei/Documents/HBuilderProjects/be-crm-main/uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue'\nwx.createComponent(Component)"],"names":["config","uni","uniCloud","mutations"],"mappings":"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"}