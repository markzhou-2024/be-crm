{"version":3,"file":"schedule.js","sources":["src/services/schedule.js"],"sourcesContent":["const STORAGE_KEY = 'MOCK_HOME_TASKS'\nlet memoryTasks = []\n\nfunction formatDate(date) {\n  const d = new Date(date)\n  const y = d.getFullYear()\n  const m = `${d.getMonth() + 1}`.padStart(2, '0')\n  const day = `${d.getDate()}`.padStart(2, '0')\n  return `${y}-${m}-${day}`\n}\n\nfunction seedTasks() {\n  const today = new Date()\n  const tomorrow = new Date(today)\n  tomorrow.setDate(today.getDate() + 1)\n  const dayAfter = new Date(today)\n  dayAfter.setDate(today.getDate() + 2)\n  return [\n    { id: 'seed-1', date: formatDate(today), time: '09:30', title: '晨会：复盘门店销售', note: '带上最新报表', created_at: Date.now() },\n    { id: 'seed-2', date: formatDate(today), time: '14:00', title: 'VIP 客户关怀电话', note: '重点介绍新疗程', created_at: Date.now() },\n    { id: 'seed-3', date: formatDate(tomorrow), time: '11:00', title: '培训：新员工产品学习', note: '', created_at: Date.now() },\n    { id: 'seed-4', date: formatDate(dayAfter), time: '16:00', title: '筹备周末沙龙', note: '确认物料与主持人', created_at: Date.now() }\n  ]\n}\n\nfunction readTasks() {\n  let list = []\n  try {\n    if (typeof uni !== 'undefined' && typeof uni.getStorageSync === 'function') {\n      list = uni.getStorageSync(STORAGE_KEY) || []\n    } else if (typeof localStorage !== 'undefined') {\n      const raw = localStorage.getItem(STORAGE_KEY)\n      list = raw ? JSON.parse(raw) : []\n    } else {\n      list = memoryTasks\n    }\n  } catch (err) {\n    console.warn('read tasks fallback', err)\n    list = memoryTasks\n  }\n  if (!list || !list.length) {\n    list = seedTasks()\n    persistTasks(list)\n  }\n  return list\n}\n\nfunction persistTasks(list) {\n  memoryTasks = JSON.parse(JSON.stringify(list))\n  try {\n    if (typeof uni !== 'undefined' && typeof uni.setStorageSync === 'function') {\n      uni.setStorageSync(STORAGE_KEY, list)\n    } else if (typeof localStorage !== 'undefined') {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(list))\n    }\n  } catch (err) {\n    console.warn('persist tasks failed', err)\n  }\n}\n\nfunction sortTasks(tasks) {\n  return tasks.slice().sort((a, b) => {\n    if (a.date === b.date) {\n      return (a.time || '').localeCompare(b.time || '')\n    }\n    return a.date.localeCompare(b.date)\n  })\n}\n\nfunction generateId() {\n  return `task-${Date.now()}-${Math.floor(Math.random() * 10000)}`\n}\n\nexport async function listAllTasks() {\n  return sortTasks(readTasks())\n}\n\nexport async function listTasksByDate(date) {\n  const list = readTasks().filter(item => item.date === date)\n  return sortTasks(list)\n}\n\nexport async function createTask(payload) {\n  const list = readTasks()\n  const task = {\n    id: generateId(),\n    date: payload.date,\n    time: payload.time || '09:00',\n    title: payload.title,\n    note: payload.note || '',\n    created_at: Date.now()\n  }\n  list.push(task)\n  persistTasks(list)\n  return task\n}\n\nexport async function updateTask(id, updates) {\n  const list = readTasks()\n  const index = list.findIndex(item => item.id === id)\n  if (index === -1) {\n    throw new Error('任务不存在')\n  }\n  list[index] = {\n    ...list[index],\n    ...updates,\n    updated_at: Date.now()\n  }\n  persistTasks(list)\n  return list[index]\n}\n\nexport async function deleteTask(id) {\n  const list = readTasks()\n  const next = list.filter(item => item.id !== id)\n  persistTasks(next)\n  return true\n}\n"],"names":["uni"],"mappings":"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"}