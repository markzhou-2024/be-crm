{"version":3,"file":"schedule.js","sources":["src/services/schedule.js"],"sourcesContent":["const bookingService = uniCloud.importObject('curd-booking', { customUI: true })\n\nfunction formatDate(value) {\n  const d = new Date(value)\n  const y = d.getFullYear()\n  const m = `${d.getMonth() + 1}`.padStart(2, '0')\n  const day = `${d.getDate()}`.padStart(2, '0')\n  return `${y}-${m}-${day}`\n}\n\nfunction formatTime(value) {\n  const d = new Date(value)\n  const hh = `${d.getHours()}`.padStart(2, '0')\n  const mm = `${d.getMinutes()}`.padStart(2, '0')\n  return `${hh}:${mm}`\n}\n\nfunction toTimestamp(dateStr, timeStr = '09:00') {\n  if (!dateStr) return null\n  const [y, m, d] = String(dateStr).split('-').map(num => Number(num))\n  const [hh = 0, mm = 0] = String(timeStr || '09:00').split(':').map(num => Number(num))\n  const date = new Date(y, (m || 1) - 1, d || 1, hh, mm, 0)\n  const ts = date.getTime()\n  return Number.isNaN(ts) ? null : ts\n}\n\nfunction unwrap(res) {\n  if (!res) return res\n  if (typeof res === 'object') {\n    if (res.errCode !== undefined && res.errCode !== 0) {\n      const err = new Error(res.errMsg || '请求失败')\n      err.errCode = res.errCode\n      throw err\n    }\n    if (res.code !== undefined && res.code !== 0) {\n      const err = new Error(res.message || res.msg || '请求失败')\n      err.code = res.code\n      throw err\n    }\n  }\n  if (res && res.data !== undefined) return res.data\n  return res\n}\n\nfunction toArray(res) {\n  if (Array.isArray(res)) return res\n  if (Array.isArray(res?.data)) return res.data\n  if (Array.isArray(res?.list)) return res.list\n  return []\n}\n\nfunction toTask(record = {}) {\n  const start = record.start_ts || record.startTs || Date.now()\n  return {\n    id: record._id || record.id,\n    date: formatDate(start),\n    time: formatTime(start),\n    title: record.service_name || record.title || '日程安排',\n    note: record.remark || record.note || '',\n    store_id: record.store_id || '',\n    store_name: record.store_name || '',\n    calendar_only: !!record.calendar_only,\n    raw: record\n  }\n}\n\nexport async function listAllTasks(params = {}) {\n  const query = {}\n  if (params.start) query.date_from = params.start\n  if (params.end) query.date_to = params.end\n  const res = await bookingService.listCalendar(query)\n  return toArray(unwrap(res)).map(toTask)\n}\n\nexport async function createTask(payload) {\n  const startTs = toTimestamp(payload.date, payload.time)\n  if (!startTs) {\n    throw new Error('时间无效')\n  }\n  const endTs = startTs + 60 * 60 * 1000\n  const res = await bookingService.addCalendar({\n    store_id: payload.store_id,\n    store_name: payload.store_name,\n    title: payload.title,\n    note: payload.note,\n    remark: payload.note,\n    start_ts: startTs,\n    end_ts: endTs\n  })\n  return toTask(unwrap(res))\n}\n\nexport async function updateTask(id, payload) {\n  const startTs = toTimestamp(payload.date, payload.time)\n  if (!startTs) {\n    throw new Error('时间无效')\n  }\n  const endTs = startTs + 60 * 60 * 1000\n  await bookingService.updateCalendar({\n    id,\n    store_id: payload.store_id,\n    store_name: payload.store_name,\n    title: payload.title,\n    note: payload.note,\n    start_ts: startTs,\n    end_ts: endTs\n  })\n  return true\n}\n\nexport async function deleteTask(id) {\n  await bookingService.removeCalendar({ id })\n  return true\n}\n"],"names":["uniCloud"],"mappings":"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"}