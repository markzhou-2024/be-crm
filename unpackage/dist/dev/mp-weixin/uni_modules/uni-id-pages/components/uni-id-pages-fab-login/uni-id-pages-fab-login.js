"use strict";const i=require("../../../../common/vendor.js"),d=require("../../config.js"),h=require("../../common/store.js"),m={computed:{agreements(){if(!d.config.agreements)return[];let{serviceUrl:e,privacyUrl:n}=d.config.agreements;return[{url:e,title:"用户服务协议"},{url:n,title:"隐私政策条款"}]},agree:{get(){return this.getParentComponent().agree},set(e){return this.getParentComponent().agree=e}}},data(){return{servicesList:[{id:"username",text:"账号登录",logo:"/uni_modules/uni-id-pages/static/login/uni-fab-login/user.png",path:"/uni_modules/uni-id-pages/pages/login/login-withpwd"},{id:"smsCode",text:"短信验证码",logo:"/uni_modules/uni-id-pages/static/login/uni-fab-login/sms.png",path:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd?type=smsCode"},{id:"weixin",text:"微信登录",logo:"/uni_modules/uni-id-pages/static/login/uni-fab-login/weixin.png"}],univerifyStyle:{fullScreen:!0,backgroundColor:"#ffffff",buttons:{iconWidth:"45px",list:[]},privacyTerms:{defaultCheckBoxState:!1,textColor:"#BBBBBB",termsColor:"#5496E3",prefix:"我已阅读并同意",suffix:"并使用本机号码登录",privacyItems:[]}}}},watch:{agree(e){this.univerifyStyle.privacyTerms.defaultCheckBoxState=e}},async created(){let e=this.servicesList,n=d.config.loginTypes;e=e.filter(t=>t.id=="apple"?!1:n.includes(t.id)),n.includes("univerify")&&(this.univerifyStyle.privacyTerms.privacyItems=this.agreements,e.forEach(({id:t,logo:s,path:a})=>{t!="univerify"&&this.univerifyStyle.buttons.list.push({iconPath:s,provider:t,path:a})})),this.servicesList=e.filter(t=>(t.path?t.path.split("?")[0]:"")!=this.getRoute(1))},methods:{getParentComponent(){return this.$parent},setUserInfo(e){i.index.__f__("log","at uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue:195","setUserInfo",e)},getRoute(e=0){let n=getCurrentPages();return e>n.length?"":"/"+n[n.length-e].route},toPage(e,n=0){if(this.getRoute(1)==e.split("?")[0]&&this.getRoute(1)=="/uni_modules/uni-id-pages/pages/login/login-withoutpwd"){let t=e.split("?")[1].split("=")[1];i.index.$emit("uni-id-pages-setLoginType",t)}else this.getRoute(2)==e?i.index.navigateBack():this.getRoute(1)!=e?n===0?i.index.navigateTo({url:e,animationType:"slide-in-left",complete(t){}}):i.index.redirectTo({url:e,animationType:"slide-in-left",complete(t){}}):i.index.__f__("log","at uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue:232","出乎意料的情况,path："+e)},async login_before(e,n=!0,t={}){var a,l;if(i.index.__f__("log","at uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue:236",e),["qq","xiaomi","sinaweibo","taobao","facebook","google","alipay","douyin"].includes(e))return i.index.showToast({title:"该登录方式暂未实现，欢迎提交pr",icon:"none",duration:3e3});if(["univerify","apple"].includes(e))return i.index.showToast({title:"当前设备不支持此登录，请选择其他登录方式",icon:"none",duration:3e3});let s=(((l=(a=d.config)==null?void 0:a.agreements)==null?void 0:l.scope)||[]).includes("register");if(e!="univerify"&&s&&!this.agree)return this.getParentComponent().$refs.agreements.popup(()=>{this.login_before(e,n,t)});if(i.index.showLoading({mask:!0}),e=="univerify"){let f=function(){i.index.hideLoading(),o.close(),o.offButtonsClick(g)},o=i.index.getUniverifyManager(),r=!1,g=async u=>{i.index.__f__("log","at uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue:354","点击了第三方登录，provider：",u,u.provider,this.univerifyStyle.buttons.list),r=!0;let p=await i.index.getCheckBoxState();this.agree=p.state;let{path:c}=this.univerifyStyle.buttons.list[u.index];c?(this.getRoute(1).includes("login-withoutpwd")&&c.includes("login-withoutpwd")&&this.getParentComponent().showCurrentWebview(),this.toPage(c,1),f()):this.agree?(f(),setTimeout(()=>{this.login_before(u.provider)},500)):i.index.showToast({title:"你未同意隐私政策协议",icon:"none",duration:3e3})};return o.onButtonsClick(g),o.login({univerifyStyle:this.univerifyStyle,success:u=>{this.login(u.authResult,"univerify")},fail(u){i.index.__f__("log","at uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue:404",u),r||i.index.navigateBack()},complete:async u=>{i.index.hideLoading(),o.offButtonsClick(g)}})}if(e==="weixinMobile")return this.login({phoneCode:t.phoneNumberCode},e);i.index.login({provider:e,onlyAuthorize:!0,success:async o=>{if(e=="apple"){let r=await this.getUserInfo({provider:"apple"});Object.assign(o.authResult,r.userInfo),i.index.hideLoading()}this.login(e=="weixin"?{code:o.code}:o.authResult,e)},fail:async o=>{i.index.__f__("log","at uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue:449",o),i.index.hideLoading()}})},login(e,n){i.index.__f__("log","at uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.vue:456",{params:e,type:n});let t="loginBy"+n.trim().replace(n[0],n[0].toUpperCase());i.tr.importObject("uni-id-co",{customUI:!0})[t](e).then(a=>{i.index.showToast({title:"登录成功",icon:"none",duration:2e3}),h.mutations.loginSuccess(a)}).catch(a=>{i.index.showModal({content:a.message,confirmText:"知道了",showCancel:!1})}).finally(a=>{n=="univerify"&&i.index.closeAuthView(),i.index.hideLoading()})},async getUserInfo(e){return new Promise((n,t)=>{i.index.getUserInfo({...e,success:s=>{n(s)},fail:s=>{i.index.showModal({content:JSON.stringify(s),showCancel:!1}),t(s)}})})}}};function _(e,n,t,s,a,l){return{a:i.f(a.servicesList,(o,r,g)=>({a:o.logo,b:i.t(o.text),c:r,d:i.o(f=>o.path?l.toPage(o.path):l.login_before(o.id,!1),r)}))}}const x=i._export_sfc(m,[["render",_]]);wx.createComponent(x);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/uni_modules/uni-id-pages/components/uni-id-pages-fab-login/uni-id-pages-fab-login.js.map
