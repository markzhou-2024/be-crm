"use strict";const e=require("../../common/vendor.js"),r=require("../../api/customers.js"),m=require("../../api/shops.js"),h={data(){return{submitting:!1,shopOptions:[],form:{name:"",phone:"",is_vip:!1,avatar:"",tags:"",city:"",notes:"",store_id:"",store_name:""}}},async onLoad(){await this.initShops()},methods:{async initShops(){try{const t=await m.fetchShops();t.length||e.index.showToast({title:"请先创建门店",icon:"none"}),this.shopOptions=t.map(s=>({value:s._id,label:s.store_name||"未命名门店"}))}catch(t){e.index.showToast({title:(t==null?void 0:t.errMsg)||(t==null?void 0:t.message)||"加载门店失败",icon:"none"}),this.shopOptions=[]}},onVipChange(t){this.form.is_vip=!!t.detail.value},onPickShop(t){const s=Number(t.detail.value),a=this.shopOptions[s];a&&(this.form.store_id=a.value,this.form.store_name=a.label)},validate(){const t=(this.form.name||"").trim(),s=(this.form.phone||"").trim();return t?s&&!/^1\d{10}$/.test(s)?(e.index.showToast({title:"手机号格式错误",icon:"none"}),!1):this.form.store_id?(this.form.name=t,this.form.phone=s,!0):(e.index.showToast({title:"请选择归属门店",icon:"none"}),!1):(e.index.showToast({title:"请填写姓名",icon:"none"}),!1)},async submit(){if(this.submitting||!this.validate())return;this.submitting=!0;const t={name:this.form.name,phone:this.form.phone,is_vip:this.form.is_vip,avatar:this.form.avatar,tags:this.form.tags,city:this.form.city,notes:this.form.notes,store_id:this.form.store_id,store_name:this.form.store_name,total_spend:0,visit_count:0,last_visit_days:0,last_visit_label:"今天"};try{await r.createCustomer(t),e.index.showToast({title:"创建成功",icon:"success"}),setTimeout(()=>e.index.navigateBack(),400)}catch(s){e.index.showToast({title:(s==null?void 0:s.errMsg)||(s==null?void 0:s.message)||"保存失败",icon:"none"})}finally{this.submitting=!1}}}};function c(t,s,a,l,i,n){return{a:i.form.name,b:e.o(o=>i.form.name=o.detail.value),c:i.form.phone,d:e.o(o=>i.form.phone=o.detail.value),e:i.form.is_vip,f:e.o((...o)=>n.onVipChange&&n.onVipChange(...o)),g:e.t(i.form.store_name||"请选择门店"),h:i.shopOptions,i:e.o((...o)=>n.onPickShop&&n.onPickShop(...o)),j:i.form.avatar,k:e.o(o=>i.form.avatar=o.detail.value),l:i.form.tags,m:e.o(o=>i.form.tags=o.detail.value),n:i.form.city,o:e.o(o=>i.form.city=o.detail.value),p:i.form.notes,q:e.o(o=>i.form.notes=o.detail.value),r:i.submitting,s:e.o((...o)=>n.submit&&n.submit(...o))}}const f=e._export_sfc(h,[["render",c],["__scopeId","data-v-d297ec96"]]);wx.createPage(f);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/my-customers/create.js.map
