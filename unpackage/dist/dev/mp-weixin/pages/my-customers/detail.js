"use strict";const t=require("../../common/vendor.js"),c=require("../../api/customers.js"),a={data(){return{id:"",customer:{},notesDraft:"",defaultAvatar:"https://cdn.uviewui.com/uview/album/1.jpg",tabs:[{label:"购买",value:"purchase"},{label:"消耗",value:"consume"},{label:"预约",value:"booking"},{label:"图库",value:"gallery"},{label:"备注",value:"notes"}],activeTab:"purchase"}},onLoad(e){if(this.id=e&&e.id||"",!this.id){t.index.showToast({title:"缺少客户ID",icon:"none"}),setTimeout(()=>t.index.navigateBack(),400);return}this.loadData()},onShow(){this.id&&this.loadData()},methods:{async loadData(){try{const e=await c.getCustomerById(this.id);if(!e){t.index.showToast({title:"客户不存在",icon:"none"}),setTimeout(()=>t.index.navigateBack(),400);return}this.customer=e,this.notesDraft=e.notes||"",t.index.setNavigationBarTitle({title:e.name||"客户详情"})}catch(e){t.index.showToast({title:(e==null?void 0:e.errMsg)||(e==null?void 0:e.message)||"加载失败",icon:"none"})}},goEdit(){t.index.navigateTo({url:`/pages/my-customers/edit?id=${this.id}`})},addBooking(){t.index.showActionSheet({itemList:["意向到店","上门服务","电话跟进"],success:()=>{t.index.showToast({title:"预约功能占位",icon:"none"})}})},async saveNotes(){try{await c.updateCustomer({_id:this.id,notes:this.notesDraft}),this.customer.notes=this.notesDraft,t.index.showToast({title:"备注已保存",icon:"success"})}catch(e){t.index.showToast({title:(e==null?void 0:e.errMsg)||(e==null?void 0:e.message)||"保存失败",icon:"none"})}},confirmDelete(){t.index.showModal({title:"删除客户",content:"删除后不可恢复，确定删除？",confirmText:"删除",confirmColor:"#dd524d",success:e=>{e.confirm&&this.deleteCustomer()}})},async deleteCustomer(){try{await c.deleteCustomer(this.id),t.index.showToast({title:"已删除",icon:"success"}),setTimeout(()=>t.index.navigateBack(),400)}catch(e){t.index.showToast({title:(e==null?void 0:e.errMsg)||(e==null?void 0:e.message)||"删除失败",icon:"none"})}},toAmount(e){try{return Number(e||0).toLocaleString("zh-CN")}catch{return e}}}};function r(e,n,m,l,s,i){return t.e({a:t.o((...o)=>i.goEdit&&i.goEdit(...o)),b:s.customer.avatar||s.defaultAvatar,c:t.t(s.customer.name),d:s.customer.is_vip},s.customer.is_vip?{}:{},{e:s.customer.store_name},s.customer.store_name?{f:t.t(s.customer.store_name)}:{},{g:s.customer.tags},s.customer.tags?{h:t.t(s.customer.tags)}:{},{i:s.customer.city},s.customer.city?{j:t.t(s.customer.city)}:{},{k:t.t(s.customer.phone||"-"),l:t.t(i.toAmount(s.customer.total_spend)),m:t.t(s.customer.visit_count||0),n:t.f(s.tabs,(o,h,v)=>({a:t.t(o.label),b:o.value,c:s.activeTab===o.value?1:"",d:t.o(d=>s.activeTab=o.value,o.value)})),o:s.activeTab==="purchase"},s.activeTab==="purchase"?{}:s.activeTab==="consume"?{}:s.activeTab==="booking"?{r:t.o((...o)=>i.addBooking&&i.addBooking(...o))}:s.activeTab==="gallery"?{}:{t:s.notesDraft,v:t.o(o=>s.notesDraft=o.detail.value),w:t.o((...o)=>i.saveNotes&&i.saveNotes(...o))},{p:s.activeTab==="consume",q:s.activeTab==="booking",s:s.activeTab==="gallery",x:t.o((...o)=>i.confirmDelete&&i.confirmDelete(...o))})}const u=t._export_sfc(a,[["render",r],["__scopeId","data-v-20dde889"]]);wx.createPage(u);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/my-customers/detail.js.map
