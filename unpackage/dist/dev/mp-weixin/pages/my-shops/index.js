"use strict";const r=require("../../common/vendor.js"),d={data(){return{tabs:[{label:"全部门店",value:"all"},{label:"营业中",value:"active"},{label:"高营收",value:"high"}],keyword:"",activeTab:"all",page:1,pageSize:10,list:[],loading:!1,error:""}},created(){this.service=r.tr.importObject("curd-shops")},onShow(){this.fetchShops()},computed:{filtered(){const e=(this.keyword||"").trim().toLowerCase();let s=this.list.slice();return this.activeTab==="active"?s=s.filter(function(l){return l.status==="active"}):this.activeTab==="high"&&(s=s.filter(function(l){return(l.month_revenue||0)>=1e5})),e&&(s=s.filter(function(l){var o=(l.store_name||"").toLowerCase(),a=(l.store_address||"").toLowerCase();return o.indexOf(e)>-1||a.indexOf(e)>-1})),s},visibleList(){return this.filtered.slice(0,this.page*this.pageSize)}},methods:{async fetchShops(){this.loading=!0,this.error="";try{const e=await this.service.listMyShops(),s=Array.isArray(e)?e:e&&e.data||[];this.list=s,this.page=1}catch(e){this.list=[],this.error=(e==null?void 0:e.errMsg)||(e==null?void 0:e.message)||"加载失败",r.index.showToast({title:this.error,icon:"none"})}finally{this.loading=!1}},switchTab(e){this.activeTab=e,this.page=1},applyFilter(){this.page=1},loadMore(){this.visibleList.length<this.filtered.length&&(this.page+=1)},openDetail(e){r.index.navigateTo({url:`/pages/my-shops/detail?id=${e._id}`})},goCreate(){r.index.navigateTo({url:"/pages/my-shops/create"})},formatMoney(e){return typeof e!="number"?e:e.toLocaleString("zh-CN")}}};function u(e,s,l,o,a,i){return r.e({a:r.o([t=>a.keyword=t.detail.value,(...t)=>i.applyFilter&&i.applyFilter(...t)]),b:a.keyword,c:r.f(a.tabs,(t,n,c)=>({a:r.t(t.label),b:t.value,c:a.activeTab===t.value?1:"",d:r.o(h=>i.switchTab(t.value),t.value)})),d:r.f(i.visibleList,(t,n,c)=>({a:t.cover_image,b:r.t(t.store_name),c:r.t(t.store_address),d:r.t(i.formatMoney(t.month_revenue)),e:r.t(t.customer_count),f:t._id,g:r.o(h=>i.openDetail(t),t._id)})),e:a.loading},a.loading?{}:a.error?{g:r.t(a.error)}:i.visibleList.length===0?{}:{},{f:a.error,h:i.visibleList.length===0,i:r.o((...t)=>i.loadMore&&i.loadMore(...t)),j:r.o((...t)=>i.goCreate&&i.goCreate(...t))})}const g=r._export_sfc(d,[["render",u],["__scopeId","data-v-d02c2fea"]]);wx.createPage(g);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/my-shops/index.js.map
